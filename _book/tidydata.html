<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 11 Tidy data: ordenando datos | Aprendiendo R sin morir en el intento</title>
<meta name="author" content="Javier Álvarez Liébana">
<meta name="description" content="Empieza lo interesante :)  Imagen/gráfica 11.1: Flujo deseable de datos según Hadley Wickham, extraída de https://r4ds.had.co.nz/wrangle-intro.html  Fíjate bien en el anterior flujo de trabajo:...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Capítulo 11 Tidy data: ordenando datos | Aprendiendo R sin morir en el intento">
<meta property="og:type" content="book">
<meta property="og:image" content="/img/logo_R.png">
<meta property="og:description" content="Empieza lo interesante :)  Imagen/gráfica 11.1: Flujo deseable de datos según Hadley Wickham, extraída de https://r4ds.had.co.nz/wrangle-intro.html  Fíjate bien en el anterior flujo de trabajo:...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 11 Tidy data: ordenando datos | Aprendiendo R sin morir en el intento">
<meta name="twitter:description" content="Empieza lo interesante :)  Imagen/gráfica 11.1: Flujo deseable de datos según Hadley Wickham, extraída de https://r4ds.had.co.nz/wrangle-intro.html  Fíjate bien en el anterior flujo de trabajo:...">
<meta name="twitter:image" content="/img/logo_R.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Sen-0.4.0/font.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=DM%20Mono&amp;display=swap" rel="stylesheet">
<link href="libs/_Bitter-0.4.0/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Aprendiendo R sin morir en el intento</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prefacio</a></li>
<li class="book-part">Toma de contacto</li>
<li><a class="" href="instalacionR.html"><span class="header-section-number">1</span> Instalación</a></li>
<li><a class="" href="primeros-pasos.html"><span class="header-section-number">2</span> Primeros pasos</a></li>
<li class="book-part">Conceptos básicos</li>
<li><a class="" href="vectores.html"><span class="header-section-number">3</span> Tipos de datos I: vectores</a></li>
<li><a class="" href="proyecto.html"><span class="header-section-number">4</span> Flujo de trabajo: primer proyecto</a></li>
<li><a class="" href="control.html"><span class="header-section-number">5</span> Estructuras de control</a></li>
<li><a class="" href="datos.html"><span class="header-section-number">6</span> Tipos de datos II: datos estructurados</a></li>
<li><a class="" href="importar-exportar.html"><span class="header-section-number">7</span> Importando/exportando</a></li>
<li class="book-part">Listas y funciones</li>
<li><a class="" href="otros-datos.html"><span class="header-section-number">8</span> Listas y factores</a></li>
<li><a class="" href="funciones.html"><span class="header-section-number">9</span> Creación de funciones</a></li>
<li class="book-part">Alto en el camino</li>
<li><a class="" href="resumen-1.html"><span class="header-section-number">10</span> ¿Qué sabemos hacer?</a></li>
<li class="book-part">EXPLORANDO: introducción al análisis exploratorio de datos</li>
<li><a class="active" href="tidydata.html"><span class="header-section-number">11</span> Tidy data: ordenando datos</a></li>
<li><a class="" href="tidyverse.html"><span class="header-section-number">12</span> Explorando los datos: incursión a tidyverse</a></li>
<li><a class="" href="resumenes.html"><span class="header-section-number">13</span> Resumiendo y relacionado los datos</a></li>
<li><a class="" href="ggplot2.html"><span class="header-section-number">14</span> Visualizando datos: incursión a ggplot2</a></li>
<li class="book-part">Epílogo</li>
<li><a class="" href="contribuye.html"><span class="header-section-number">15</span> Contribuye al proyecto</a></li>
<li><a class="" href="bibliograf%C3%ADa.html">Bibliografía</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/dadosdelaplace/cursoR_intro_2021_2022">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tidydata" class="section level1">
<h1>
<span class="header-section-number">Capítulo 11</span> Tidy data: ordenando datos<a class="anchor" aria-label="anchor" href="#tidydata"><i class="fas fa-link"></i></a>
</h1>
<p>Empieza lo interesante :)</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:flujo-tidy-data"></span>
<img src="img/flujo_tidy_data.jpg" alt="Flujo deseable de datos según Hadley Wickham, extraída de &lt;https://r4ds.had.co.nz/wrangle-intro.html&gt;" width="60%"><p class="caption">
Imagen/gráfica 11.1: Flujo deseable de datos según Hadley Wickham, extraída de <a href="https://r4ds.had.co.nz/wrangle-intro.html" class="uri">https://r4ds.had.co.nz/wrangle-intro.html</a>
</p>
</div>
<p>Fíjate bien en el anterior <strong>flujo de trabajo</strong>: aunque el objetivo de este manual es muy introductorio, y no vamos a profundizar excesivamente en ninguna de las etapas, si queremos acabar teniendo unas nociones básicas de comunicar los datos <strong>vamos a necesitar algunas nociones básicas de cómo prepararlos y de cómo modelizarlos</strong>.</p>
<p>El <strong>primero de los pasos</strong>, la <a href="importar-exportar.html#importar-exportar">importación de datos</a>, la hemos revisado de forma superficial en la Sección <a href="importar-exportar.html#importar-exportar">7</a>, pero <strong>nos bastará con lo aprendido</strong> para poder empezar a manipular datos. Antes de pasar al segundo paso, <strong>la limpieza de los datos</strong>, vamos a repasar los tipos de datos que hemos hasta ahora.</p>
<div id="repaso_datos" class="section level2">
<h2>
<span class="header-section-number">11.1</span> Repaso: tipos de datos<a class="anchor" aria-label="anchor" href="#repaso_datos"><i class="fas fa-link"></i></a>
</h2>
<p>¿Existen más tipos de datos de los que ya conocemos?</p>
<p>La respuesta te la estarás imaginando: sí. De hecho no es solo que existan más sino que <strong>puedes crear tus propias clases de variables</strong>, pero seguramente acabarán siendo, en su nivel más profundo, una combinación de alguna de las estructuras que ya conocemos. El objetivo de este curso es empezar a ser autónomo/a en el análisis de datos, pero <strong>no es un curso profundo de R</strong>, así que (de momento) vamos a quedarnos como estamos.</p>
<p> </p>
<p><strong><span style="color: #4197D2;">GLOSARIO:</span></strong></p>
<p>Si es importante entender las diferencias entre los datos que ya hemos definido.</p>
<ul>
<li><p><strong><span style="color: #4197D2;">Vectores</span></strong>: es el tipo de dato más simple, una colección de valores <strong>PERO DEL MISMO TIPO</strong>. Los vectores pueden ser de longitud 1 (valores individuales a secas), una <strong>colección de números</strong>, una <strong>colección de cadenas de texto</strong> o una <strong>colección de valores lógicos</strong> (pudiendo tener dentro datos ausentes, o valores especiales como <code>Inf</code> o <code>NaN</code>)</p></li>
<li><p><strong><span style="color: #4197D2;">Matrices</span></strong>: se pueden entender como una especie de colección de vectores, una colección de colecciones, un tipo de dato <strong>BIDIMENSIONAL</strong>. Una matriz se conforma de filas y columnas pero, de nuevo, <strong>LOS DATOS DEBEN SER DEL MISMO TIPO</strong>, y los vectores concatenados que forma las filas y/o columnas <strong>DEBEN TENER LA MISMA LONGITUD</strong>.</p></li>
<li><ul>
<li>
<strong><span style="color: #4197D2;">data,frame</span></strong>: son datos estructurados, lo que comunmente conocemos como «tablas». A diferencia de las matrices, aunque deben <strong>SEGUIR TENIENDO LA MISMA LONGITUD</strong>, las variables que lo conforman pueden ser de <strong>TIPOS DIFERENTES</strong>, puediendo tener el mismo conjunto de datos numéricos, caracteres, lógicos, etc.</li>
</ul></li>
<li><ul>
<li>
<strong><span style="color: #4197D2;">Listas</span></strong>: las listas son una concatenación de elementos, a secas, de forma que nos permite concatenar cualquier tipo de dato anterior, pudiendo ser de <strong>DIFERENTE LONGITUD Y DIFERENTE TIPO</strong>.</li>
</ul></li>
</ul>
<p> </p>
<p><strong><span style="color: #ffc107;">WARNING: cuidado con las listas</span></strong></p>
<p>Como hemos mencionado, una <strong><span style="color: #ffc107;">lista no se puede vectorizar de forma inmediata</span></strong>, por lo cualquier operación aritmética aplicada a una lista dará error. Para poder operar con ellas tenemos una opción que es aplicar la función <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>, o directamente acudir al paquete <a href="http://purrr.tidyverse.org">purrr</a>.</p>
<div class="sourceCode" id="cb682"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"purrr"</span><span class="op">)</span> <span class="co"># solo la primera vez</span></code></pre></div>
<p>Veamos un ejemplo muy sencillo (te animo a investigar en dicho paquete pero se escapa de los objetivos del curso): vamos definir una lista y a <strong>aplicar la misma función para cada uno de los elementos de la misma</strong>.</p>
<div class="sourceCode" id="cb683"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>

<span class="co"># Creamos una lista de tres elementos</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span>, <span class="fl">11</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Aplicamos una función a cada elemento de la lista</span>
<span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 6
## 
## [[2]]
## [1] 22
## 
## [[3]]
## [1] 50</code></pre>
<p>Si no indicamos nada, la salida será a su vez una lista. Dado que la función que vamos a aplicar es la suma de cada uno de los elementos que conforman la lista original, y nos <strong>devolverá en cada simplemente un número</strong>, quizás puede ser más útil pedir que nos lo devuelva en un vector de números.</p>
<div class="sourceCode" id="cb685"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Aplicamos una función a cada elemento de la lista</span>
<span class="co"># y le pedimos que nos devuelva un vector de números</span>
<span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_dbl</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></code></pre></div>
<pre><code>## [1]  6 22 50</code></pre>
<p> </p>
</div>
<div id="tibble" class="section level2">
<h2>
<span class="header-section-number">11.2</span> Mejorando los data.frame: datos tibble<a class="anchor" aria-label="anchor" href="#tibble"><i class="fas fa-link"></i></a>
</h2>
<p>Antes de ordenar, limpiar y procesar nuestros datos, vamos a ver un tipo de dato que mencionamos por encima en su momento: las tablas <code>tibble</code>. Los datos en formato <code>tibble</code> (del paquete <a href="https://tibble.tidyverse.org/">tibble</a>) son un <strong>tipo de <code>data.frame</code> mejorado, para una gestión más ágil, eficiente y coherente</strong>. Las <strong>tablas en formato tibble (su clase será tbl_df)</strong> tiene 4 ventajas principales frente a los ya vistos <code>data.frame</code>:</p>
<ul>
<li>Permite <strong>imprimir por consola la tabla con mayor información</strong> de las variables, y <strong>solo imprime por defecto las primeras filas</strong> (todas si son 20 o menos, 10 si son más de 20 filas).</li>
</ul>
<div class="sourceCode" id="cb687"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span>

<span class="co"># data.frame</span>
<span class="va">tabla_df</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"x"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>,
             <span class="st">"y"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>,
             <span class="st">"z"</span> <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">60</span>,
             <span class="st">"logica"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="va">tabla_df</span></code></pre></div>
<pre><code>##     x y  z logica
## 1   1 a 11   TRUE
## 2   2 b 12   TRUE
## 3   3 c 13  FALSE
## 4   4 d 14   TRUE
## 5   5 e 15  FALSE
## 6   6 a 16   TRUE
## 7   7 b 17   TRUE
## 8   8 c 18  FALSE
## 9   9 d 19   TRUE
## 10 10 e 20  FALSE
## 11 11 a 21   TRUE
## 12 12 b 22   TRUE
## 13 13 c 23  FALSE
## 14 14 d 24   TRUE
## 15 15 e 25  FALSE
## 16 16 a 26   TRUE
## 17 17 b 27   TRUE
## 18 18 c 28  FALSE
## 19 19 d 29   TRUE
## 20 20 e 30  FALSE
## 21 21 a 31   TRUE
## 22 22 b 32   TRUE
## 23 23 c 33  FALSE
## 24 24 d 34   TRUE
## 25 25 e 35  FALSE
## 26 26 a 36   TRUE
## 27 27 b 37   TRUE
## 28 28 c 38  FALSE
## 29 29 d 39   TRUE
## 30 30 e 40  FALSE
## 31 31 a 41   TRUE
## 32 32 b 42   TRUE
## 33 33 c 43  FALSE
## 34 34 d 44   TRUE
## 35 35 e 45  FALSE
## 36 36 a 46   TRUE
## 37 37 b 47   TRUE
## 38 38 c 48  FALSE
## 39 39 d 49   TRUE
## 40 40 e 50  FALSE
## 41 41 a 51   TRUE
## 42 42 b 52   TRUE
## 43 43 c 53  FALSE
## 44 44 d 54   TRUE
## 45 45 e 55  FALSE
## 46 46 a 56   TRUE
## 47 47 b 57   TRUE
## 48 48 c 58  FALSE
## 49 49 d 59   TRUE
## 50 50 e 60  FALSE</code></pre>
<div class="sourceCode" id="cb689"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># tibble</span>
<span class="va">tabla_tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble</a></span><span class="op">(</span><span class="st">"x"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>,
             <span class="st">"y"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>,
             <span class="st">"z"</span> <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">60</span>,
             <span class="st">"logica"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="va">tabla_tb</span></code></pre></div>
<pre><code>## # A tibble: 50 × 4
##        x y         z logica
##    &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;lgl&gt; 
##  1     1 a        11 TRUE  
##  2     2 b        12 TRUE  
##  3     3 c        13 FALSE 
##  4     4 d        14 TRUE  
##  5     5 e        15 FALSE 
##  6     6 a        16 TRUE  
##  7     7 b        17 TRUE  
##  8     8 c        18 FALSE 
##  9     9 d        19 TRUE  
## 10    10 e        20 FALSE 
## # … with 40 more rows</code></pre>
<p>Puedes imprimir las filas y columnas que quieras con <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>, pero por defecto te aseguras de <strong>no saturar la consola</strong>.</p>
<div class="sourceCode" id="cb691"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tabla_tb</span>, n <span class="op">=</span> <span class="fl">13</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 50 × 4
##        x y         z logica
##    &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;lgl&gt; 
##  1     1 a        11 TRUE  
##  2     2 b        12 TRUE  
##  3     3 c        13 FALSE 
##  4     4 d        14 TRUE  
##  5     5 e        15 FALSE 
##  6     6 a        16 TRUE  
##  7     7 b        17 TRUE  
##  8     8 c        18 FALSE 
##  9     9 d        19 TRUE  
## 10    10 e        20 FALSE 
## 11    11 a        21 TRUE  
## 12    12 b        22 TRUE  
## 13    13 c        23 FALSE 
## # … with 37 more rows</code></pre>
<ul>
<li>Los <strong>datos de tipo caracter (cadenas de texto) son guardados como tal</strong> (y no como factores).</li>
</ul>
<div class="sourceCode" id="cb693"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Caracteres en un data.frame</span>
<span class="va">tabla_df</span><span class="op">$</span><span class="va">y</span></code></pre></div>
<pre><code>##  [1] a b c d e a b c d e a b c d e a b c d e a b c d e a b c d e a b c d e a b c
## [39] d e a b c d e a b c d e
## Levels: a b c d e</code></pre>
<div class="sourceCode" id="cb695"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Caracteres en un tibble</span>
<span class="va">tabla_tb</span><span class="op">$</span><span class="va">y</span></code></pre></div>
<pre><code>##  [1] "a" "b" "c" "d" "e" "a" "b" "c" "d" "e" "a" "b" "c" "d" "e" "a" "b" "c" "d"
## [20] "e" "a" "b" "c" "d" "e" "a" "b" "c" "d" "e" "a" "b" "c" "d" "e" "a" "b" "c"
## [39] "d" "e" "a" "b" "c" "d" "e" "a" "b" "c" "d" "e"</code></pre>
<ul>
<li>La <strong>función <code><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble()</a></code> construye las variables secuencialmente</strong>, pudiendo hacer uso en la propia definición de variables recién definidas en dicha definición.</li>
</ul>
<div class="sourceCode" id="cb697"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># data.frame</span>
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"x"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
           <span class="st">"y"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span><span class="op">)</span>,
           <span class="st">"z"</span> <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">15</span>,
           <span class="st">"logica"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,
           <span class="st">"x*z"</span> <span class="op">=</span> <span class="va">x</span> <span class="op">*</span> <span class="va">z</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in x * z: argumento no-numérico para operador binario</code></pre>
<div class="sourceCode" id="cb699"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># tibble</span>
<span class="fu"><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble</a></span><span class="op">(</span><span class="st">"x"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
       <span class="st">"y"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span><span class="op">)</span>,
       <span class="st">"z"</span> <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">15</span>,
       <span class="st">"logica"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,
       <span class="st">"x*z"</span> <span class="op">=</span> <span class="va">x</span> <span class="op">*</span> <span class="va">z</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##       x y         z logica `x*z`
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;lgl&gt;  &lt;int&gt;
## 1     1 a        11 TRUE      11
## 2     2 b        12 TRUE      24
## 3     3 c        13 FALSE     39
## 4     4 d        14 TRUE      56
## 5     5 e        15 FALSE     75</code></pre>
<ul>
<li>Si <strong>accedes a una columna que no existe avisa</strong> con un warning.</li>
</ul>
<div class="sourceCode" id="cb701"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># data.frame</span>
<span class="va">tabla_df</span><span class="op">$</span><span class="va">variable_inexistente</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb703"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># tibble</span>
<span class="va">tabla_tb</span><span class="op">$</span><span class="va">variable_inexistente</span></code></pre></div>
<pre><code>## Warning: Unknown or uninitialised column: `variable_inexistente`.</code></pre>
<pre><code>## NULL</code></pre>
<ul>
<li>No solo no te cambiará el tipo de datos sino que <strong>no te cambiará el nombre de las variables</strong> (los <code>data.frame</code> transforma los caracteres que no sean letras).</li>
</ul>
<div class="sourceCode" id="cb706"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># data.frame</span>
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">":)"</span> <span class="op">=</span> <span class="st">"emoticono"</span>, <span class="st">" "</span> <span class="op">=</span> <span class="st">"en blanco"</span>, <span class="st">"2000"</span> <span class="op">=</span> <span class="st">"número"</span><span class="op">)</span></code></pre></div>
<pre><code>##         X..        X.  X2000
## 1 emoticono en blanco número</code></pre>
<div class="sourceCode" id="cb708"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># tibble</span>
<span class="fu"><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble</a></span><span class="op">(</span><span class="st">":)"</span> <span class="op">=</span> <span class="st">"emoticono"</span>, <span class="st">" "</span> <span class="op">=</span> <span class="st">"en blanco"</span>, <span class="st">"2000"</span> <span class="op">=</span> <span class="st">"número"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   `:)`      ` `       `2000`
##   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; 
## 1 emoticono en blanco número</code></pre>
<p> </p>
<p><strong><span style="color: #20935E;">CONSEJO: convertir a tibble</span></strong></p>
<p>Si ya tienes un <code>data.frame</code> es altamente recomendable convertirlo a tibble con <code><a href="https://rdrr.io/pkg/tibble/man/as_tibble.html">as_tibble()</a></code></p>
<div class="sourceCode" id="cb710"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tibble/man/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">tabla_df</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 50 × 4
##        x y         z logica
##    &lt;int&gt; &lt;fct&gt; &lt;int&gt; &lt;lgl&gt; 
##  1     1 a        11 TRUE  
##  2     2 b        12 TRUE  
##  3     3 c        13 FALSE 
##  4     4 d        14 TRUE  
##  5     5 e        15 FALSE 
##  6     6 a        16 TRUE  
##  7     7 b        17 TRUE  
##  8     8 c        18 FALSE 
##  9     9 d        19 TRUE  
## 10    10 e        20 FALSE 
## # … with 40 more rows</code></pre>
<p> </p>
<p>Puedes consultar más funcionalidades de dichos datos en <a href="https://tibble.tidyverse.org/" class="uri">https://tibble.tidyverse.org/</a>.</p>
</div>
<div id="tidy" class="section level2">
<h2>
<span class="header-section-number">11.3</span> Tidy data vs messy data<a class="anchor" aria-label="anchor" href="#tidy"><i class="fas fa-link"></i></a>
</h2>
<blockquote>
<p>Tidy datasets are all alike, but every messy dataset is messy in its own way (Hadley Wickham, Chief Scientist en RStudio)</p>
</blockquote>
<p>Hasta ahora solo le hemos dado importancia al «qué» pero no al <strong>«cómo» manejamos los datos</strong>. La <strong>organización de nuestros datos</strong> es fundamental para que la preparación y explotación de los datos sea <strong>lo más eficiente posible</strong>: la limpieza y preprocesamiento puede llevarnos hasta el <strong>80% del tiempo</strong> en nuestro análisis si no se hace forma correcta <span class="citation">(Dasu and Johnson <a href="bibliograf%C3%ADa.html#ref-DasuJohnson03">2003</a>)</span>.</p>
<p>El concepto <em>tidy data</em> fue introducido por <strong>Hadley Wickham</strong> <span class="citation">(Wickham <a href="bibliograf%C3%ADa.html#ref-Wickham14">2014</a>)</span> como objetivo del entorno de paquetes que posteriormente se fueron desarrollando en el entorno <a href="https://tidyverse.tidyverse.org">tidyverse</a>. Los conjuntos <em>tidy</em> o <strong>datos ordenados</strong> tienen tres objetivos</p>
<ul>
<li>
<strong>Estandarización</strong> en su estructura.</li>
<li>
<strong>Sencillez</strong> en su manipulación.</li>
<li>Listos para ser <strong>modelizados y visualizados</strong>.</li>
</ul>
<p>Para ello, los <strong>datos ordenados</strong> o <em>tidy data</em> deben cumplir:</p>
<ol style="list-style-type: decimal">
<li>Cada <strong>variable</strong> medida tiene que estar en una <strong>columna</strong>.</li>
<li>Cada <strong>observación/registro/individuo</strong> de cada una de esas variables tiene que estar en una <strong>fila diferente</strong>.</li>
<li>Cada <strong>celda</strong> de la tabla debe contener un <strong>único valor</strong>.</li>
<li>Cada <strong>conjunto o unidad observacional</strong> debe conformar una <strong>tabla</strong>.</li>
<li>Si contamos con <strong>múltiples tablas</strong>, debemos tener una <strong>columna común</strong> en cada una que nos permita <strong>cruzarlas</strong>.</li>
</ol>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:tidy-data"></span>
<img src="img/tidy_data.png" alt="Infografía con datos ordenados (tidy data) extraída de &lt;https://r4ds.had.co.nz/tidy-data.html&gt;" width="80%"><p class="caption">
Imagen/gráfica 11.2: Infografía con datos ordenados (tidy data) extraída de <a href="https://r4ds.had.co.nz/tidy-data.html" class="uri">https://r4ds.had.co.nz/tidy-data.html</a>
</p>
</div>
<p>Lo contrario lo llamaremos <strong>datos desordenados</strong> o <em>messy data</em>. Para trabajar con los datos vamos a cargar <a href="https://tidyverse.tidyverse.org">tidyverse</a>, un entorno de paquetes para el manejo de datos (ver más detalles en <a href="tidyverse.html#tidyverse">Transformando los datos: incursión al universo tidyverse</a>).</p>
<div class="sourceCode" id="cb712"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span> <span class="co"># SOLO la primera vez</span></code></pre></div>
<div class="sourceCode" id="cb713"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<div id="messy-data-valores-en-columnas-en-lugar-de-variables" class="section level3">
<h3>
<span class="header-section-number">11.3.1</span> Messy data: valores en columnas en lugar de variables<a class="anchor" aria-label="anchor" href="#messy-data-valores-en-columnas-en-lugar-de-variables"><i class="fas fa-link"></i></a>
</h3>
<p>Vamos a visualizar la tabla <code>table4a</code> del paquete <a href="https://tidyr.tidyverse.org">tidyr</a> (que ya lo tenemos cargado del entorno <a href="https://tidyverse.tidyverse.org">tidyverse</a>).</p>
<div class="sourceCode" id="cb714"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table4a</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   country     `1999` `2000`
## * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<p>Si te fijas, tenemos una columna <code>country</code>, representando una variable con el nombre de los países, <strong>¡pero las otras columnas no representan cada una a una variables!</strong> Ambas son la misma variable, solo que medida en años distintos (que debería ser a su vez otra variable): <strong>cada fila está representando dos observaciones</strong> (1999, 2000) en lugar de un solo registro. Lo que haremos será incluir una nueva columna llamada <code>year</code> que nos marque el año y otra <code>values</code> que nos diga el valor de la variable de interés en cada uno de esos años.</p>
<p>Con la función <code>pivot_longer</code> del mencionada paquete le indicaremos lo siguiente:</p>
<ul>
<li>
<code>cols</code>: el nombre de las columnas que vamos a <strong>pivotar</strong> (con comillas porque son números, no texto como nombre).</li>
<li>
<code>names_to</code>: el nombre de la columna a la que vamos a mandar los valores que figuran ahora en los nombres de las columnas.</li>
<li>
<code>values_to</code>: el nombre de la columna a la que vamos a mandar los valores.</li>
</ul>
<div class="sourceCode" id="cb716"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table4a</span> <span class="op">%&gt;%</span> <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1999"</span>, <span class="st">"2000"</span><span class="op">)</span>,
                         names_to <span class="op">=</span> <span class="st">"year"</span>,
                         values_to <span class="op">=</span> <span class="st">"values"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   country     year  values
##   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;
## 1 Afghanistan 1999     745
## 2 Afghanistan 2000    2666
## 3 Brazil      1999   37737
## 4 Brazil      2000   80488
## 5 China       1999  212258
## 6 China       2000  213766</code></pre>
<p>Ahora tenemos un <strong>registro por fila, una variable por columna y cada celda representa un único valor</strong>. Este ejemplo de <em>messy data</em> lo podemos encontrar muy a menudo cuando <strong>construimos rangos de variables</strong> pensando que es mejor tener una tabla más compacta (alargar la tabla a lo ancho en lugar de a lo largo). Es el caso de la tabla <code>relig_income</code>.</p>
<div class="sourceCode" id="cb718"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">relig_income</span></code></pre></div>
<pre><code>## # A tibble: 18 × 11
##    religion `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`
##    &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1 Agnostic      27        34        60        81        76       137        122
##  2 Atheist       12        27        37        52        35        70         73
##  3 Buddhist      27        21        30        34        33        58         62
##  4 Catholic     418       617       732       670       638      1116        949
##  5 Don’t k…      15        14        15        11        10        35         21
##  6 Evangel…     575       869      1064       982       881      1486        949
##  7 Hindu          1         9         7         9        11        34         47
##  8 Histori…     228       244       236       238       197       223        131
##  9 Jehovah…      20        27        24        24        21        30         15
## 10 Jewish        19        19        25        25        30        95         69
## 11 Mainlin…     289       495       619       655       651      1107        939
## 12 Mormon        29        40        48        51        56       112         85
## 13 Muslim         6         7         9        10         9        23         16
## 14 Orthodox      13        17        23        32        32        47         38
## 15 Other C…       9         7        11        13        13        14         18
## 16 Other F…      20        33        40        46        49        63         46
## 17 Other W…       5         2         3         4         2         7          3
## 18 Unaffil…     217       299       374       365       341       528        407
## # … with 3 more variables: $100-150k &lt;dbl&gt;, &gt;150k &lt;dbl&gt;,
## #   Don't know/refused &lt;dbl&gt;</code></pre>
<p>Salvo la primera, el resto de columnas tienen como <strong>nombre los valores de una variable en sí misma</strong> (ingresos). Para ordenar los datos vamos a razonar de la misma manera solo que ahora, en lugar de indicarle el nombre de todas las columnas que queremos usar de entrada, vamos a <strong>indicarle de forma más corta la columna que NO queremos seleccionar</strong>.</p>
<div class="sourceCode" id="cb720"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># No necesitamos las comillas en el nombre de columnas salvo que tengan caracteres que no sean letras</span>
<span class="va">relig_income</span> <span class="op">%&gt;%</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">religion</span>, names_to <span class="op">=</span> <span class="st">"ingresos"</span>,
                              values_to <span class="op">=</span> <span class="st">"frecuencia"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 180 × 3
##    religion ingresos           frecuencia
##    &lt;chr&gt;    &lt;chr&gt;                   &lt;dbl&gt;
##  1 Agnostic &lt;$10k                      27
##  2 Agnostic $10-20k                    34
##  3 Agnostic $20-30k                    60
##  4 Agnostic $30-40k                    81
##  5 Agnostic $40-50k                    76
##  6 Agnostic $50-75k                   137
##  7 Agnostic $75-100k                  122
##  8 Agnostic $100-150k                 109
##  9 Agnostic &gt;150k                      84
## 10 Agnostic Don't know/refused         96
## # … with 170 more rows</code></pre>
<p>Lo que hacemos con <code>pivot_longer()</code> es <strong>«ampliar» la tabla, haciéndola más larga (más filas) pero con menos columnas</strong>.</p>
</div>
<div id="messy-data-una-observación-guardada-en-varias-filas" class="section level3">
<h3>
<span class="header-section-number">11.3.2</span> Messy data: una observación guardada en varias filas<a class="anchor" aria-label="anchor" href="#messy-data-una-observaci%C3%B3n-guardada-en-varias-filas"><i class="fas fa-link"></i></a>
</h3>
<p>Vamos a visualizar la tabla <code>table2</code> del paquete <a href="https://tidyr.tidyverse.org">tidyr</a>.</p>
<div class="sourceCode" id="cb722"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table2</span></code></pre></div>
<pre><code>## # A tibble: 12 × 4
##    country      year type            count
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<p>Fíjate en las cuatro primeras filas: los registros con el mismo año deberían ser el mismo, es la misma información, debería estar en la misma fila, pero está dividada en dos. Por un lado una fila para la variable <code>cases</code> y otra para <code>population</code>. Lo que haremos será lo opuesto a antes: con <code>pivot_wider()</code> <strong>«ampliaremos» la tabla a lo ancho, haciéndola menos (menos filas) pero con más columnas</strong>.</p>
<ul>
<li>
<code>names_from</code>: el nombre de la columna de la que vamos a sacar las nuevas columnas que vamos a crear (<code>cases</code> y <code>population</code>).</li>
<li>
<code>values_from</code>: el nombre de la columna de la que vamos a sacar los valores.</li>
</ul>
<div class="sourceCode" id="cb724"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table2</span> <span class="op">%&gt;%</span> <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">type</span>, values_from <span class="op">=</span> <span class="va">count</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Ahora tenemos <strong>cada registro en una fila</strong>, que nos indica país-año-casos-población.</p>
</div>
<div id="messy-data-una-celda-con-múltiples-valores" class="section level3">
<h3>
<span class="header-section-number">11.3.3</span> Messy data: una celda con múltiples valores<a class="anchor" aria-label="anchor" href="#messy-data-una-celda-con-m%C3%BAltiples-valores"><i class="fas fa-link"></i></a>
</h3>
<p>Por último vamos a visualizar la tabla <code>table3</code> del paquete <a href="https://tidyr.tidyverse.org">tidyr</a>.</p>
<div class="sourceCode" id="cb726"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table3</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
<p>En la variable <code>rate</code> hay guardados dos valores, separados por <code><a href="https://rdrr.io/r/base/Arithmetic.html">/</a></code>, lo que hace que en <strong>una celda no tiene un único valor sino dos</strong>. La función <code>separate()</code> del paquete <a href="https://tidyr.tidyverse.org">tidyr</a> nos permitirá <strong>separar los múltiples valores de la columna</strong> <code>rate</code> simplemente indicándole el nombre de las nuevas columnas en el argumento <code>into = ...</code>, creando una nueva columna para cada uno de ellos.</p>
<div class="sourceCode" id="cb728"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table3</span> <span class="op">%&gt;%</span> <span class="fu">separate</span><span class="op">(</span><span class="va">rate</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country      year cases  population
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     
## 1 Afghanistan  1999 745    19987071  
## 2 Afghanistan  2000 2666   20595360  
## 3 Brazil       1999 37737  172006362 
## 4 Brazil       2000 80488  174504898 
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Por defecto lo que hace es <strong>localizar como separador cualquier caracter que no sea alfa-numérico</strong>. Si queremos un caracter concreto para dividir podemos indicárselo explícitamente</p>
<div class="sourceCode" id="cb730"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table3</span> <span class="op">%&gt;%</span> <span class="fu">separate</span><span class="op">(</span><span class="va">rate</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country      year cases  population
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     
## 1 Afghanistan  1999 745    19987071  
## 2 Afghanistan  2000 2666   20595360  
## 3 Brazil       1999 37737  172006362 
## 4 Brazil       2000 80488  174504898 
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Si <strong>usas un separador que no está en los datos</strong> te devolverá dichas columnas vacías ya que no ha podido dividirlas.</p>
<div class="sourceCode" id="cb732"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table3</span> <span class="op">%&gt;%</span> <span class="fu">separate</span><span class="op">(</span><span class="va">rate</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Additional pieces discarded in 6 rows [1, 2, 3, 4,
## 5, 6].</code></pre>
<pre><code>## # A tibble: 6 × 4
##   country      year cases population
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     
## 1 Afghanistan  1999 ""    ""        
## 2 Afghanistan  2000 ""    ""        
## 3 Brazil       1999 ""    ""        
## 4 Brazil       2000 ""    ""        
## 5 China        1999 ""    ""        
## 6 China        2000 ""    ""</code></pre>
<p> </p>
<p><strong><span style="color: #20935E;">CONSEJO: convertir variables</span></strong></p>
<p>Una opción muy útil que podemos usar al aplicar la separación de los múltiples valores es <strong>convertir los datos al tipo adecuado</strong>. Los datos unidos en <code>rate</code> eran caracteres ya que tenía el separador <code><a href="https://rdrr.io/r/base/Arithmetic.html">/</a></code> (no podían ser numéricos). Al separarlos, por defecto, aunque ahora ya son solo números, los separa como si fueran textos. Con <code>convert = TRUE</code> podemos indicarle que identifique el tipo de dato y lo convierta (fíjate en la cabecera de las columnas ahora).</p>
<div class="sourceCode" id="cb735"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table3</span> <span class="op">%&gt;%</span> 
  <span class="fu">separate</span><span class="op">(</span><span class="va">rate</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span>, convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p> </p>
<p>Dicha función también puede ser usada para <strong>dividir cifras, como por ejemplo el año</strong></p>
<div class="sourceCode" id="cb737"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table3</span> <span class="op">%&gt;%</span> <span class="fu">separate</span><span class="op">(</span><span class="va">year</span>,
                    into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"siglo"</span>, <span class="st">"año"</span><span class="op">)</span>,
                    sep <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country     siglo año   rate             
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;            
## 1 Afghanistan 19    99    745/19987071     
## 2 Afghanistan 20    00    2666/20595360    
## 3 Brazil      19    99    37737/172006362  
## 4 Brazil      20    00    80488/174504898  
## 5 China       19    99    212258/1272915272
## 6 China       20    00    213766/1280428583</code></pre>
<p>De la misma manera que podemos separar columnas <strong>también podemos unirlas</strong>. Para ello vamos a usar la tabla <code>table5</code> del ya mencionado paquete. Con la función <code>unite()</code> vamos a unir el siglo (en <code>century</code>) y el año (en <code>year</code>), y al inicio le indicaremos como se llamará la nueva variable (<code>año_completo</code>).</p>
<div class="sourceCode" id="cb739"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table5</span> <span class="op">%&gt;%</span> <span class="fu">unite</span><span class="op">(</span><span class="va">año_completo</span>, <span class="va">century</span>, <span class="va">year</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   country     año_completo rate             
##   &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;            
## 1 Afghanistan 19_99        745/19987071     
## 2 Afghanistan 20_00        2666/20595360    
## 3 Brazil      19_99        37737/172006362  
## 4 Brazil      20_00        80488/174504898  
## 5 China       19_99        212258/1272915272
## 6 China       20_00        213766/1280428583</code></pre>
<p>Como pasaba en <code>separate()</code>, tiene un argumento de separador por defecto, en este caso <code>sep = "_"</code>. <strong>Si queremos cambiarlo podemos hacerlo indicándoselo explícitamente</strong>.</p>
<div class="sourceCode" id="cb741"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table5</span> <span class="op">%&gt;%</span>
  <span class="fu">unite</span><span class="op">(</span><span class="va">año_completo</span>, <span class="va">century</span>, <span class="va">year</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   country     año_completo rate             
##   &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;            
## 1 Afghanistan 1999         745/19987071     
## 2 Afghanistan 2000         2666/20595360    
## 3 Brazil      1999         37737/172006362  
## 4 Brazil      2000         80488/174504898  
## 5 China       1999         212258/1272915272
## 6 China       2000         213766/1280428583</code></pre>
</div>
</div>
<div id="ejercicios-6" class="section level2">
<h2>
<span class="header-section-number">11.4</span> 📝 Ejercicios<a class="anchor" aria-label="anchor" href="#ejercicios-6"><i class="fas fa-link"></i></a>
</h2>
<p>(haz click en las flechas para ver soluciones)</p>
<details><p><summary>📝<strong>Ejercicio 1</strong>: ¿es el conjunto de datos <code><a href="https://rdrr.io/r/datasets/anscombe.html">datasets::anscombe</a></code> (del paquete <code>{datasets}</code>) de tipo <code>tibble</code>? </summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<p>Recuerda que podemos cargar elementos de un paquete (en este caso <code>{datasets}</code>) cargando <code><a href="https://rdrr.io/r/base/library.html">library(datasets)</a></code> y luego el elemento, o bien <code><a href="https://rdrr.io/r/datasets/anscombe.html">datasets::anscombe</a></code> (prefijo::nombre).</p>
<p>La respuesta: NO. Tienes muchas formas de comprobarlo si imprimes el conjunto por defecto.</p>
<div class="sourceCode" id="cb743"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mtcars</span></code></pre></div>
<pre><code>##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
<ul>
<li>Imprime por defecto todas las filas (tiene 32 filas, debería imprimir solo 10 si fuese un tibble, para no saturar consola).</li>
<li>No especifica al imprimir que es de tipo <code>tibble</code>.</li>
<li>No especifica al imprimir el tipo de dato de las columnas.</li>
<li>Imprime el nombre de las filas (el nombre de los modelos) como si fuera una variable (¡que no existe!).</li>
</ul>
<p>Así debería de salir si fuera <code>tibble</code>.</p>
<div class="sourceCode" id="cb745"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tibble/man/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 32 × 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
##  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
##  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
##  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
##  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
##  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
##  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
##  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
##  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
## 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
## # … with 22 more rows</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 2</strong>: define un <code>tibble</code> con tres variables numéricas, tal que la tercera sea el producto de las dos primeras. Inténtalo hacer con un <code>data.frame</code></summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<p>Un ejemplo:</p>
<div class="sourceCode" id="cb747"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble</a></span><span class="op">(</span><span class="st">"a"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, <span class="st">"b"</span> <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">17</span>, <span class="st">"c"</span> <span class="op">=</span> <span class="va">a</span> <span class="op">*</span> <span class="va">b</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 7 × 3
##       a     b     c
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     1    11    11
## 2     2    12    24
## 3     3    13    39
## 4     4    14    56
## 5     5    15    75
## 6     6    16    96
## 7     7    17   119</code></pre>
<p>Si lo intentamos con un <code>data.frame</code>, intentará buscar una variable real que tengamos guardada que se llame <code>a</code> y <code>b</code>, sin encontrarlas.</p>
<div class="sourceCode" id="cb749"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"a"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, <span class="st">"b"</span> <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">17</span>, <span class="st">"c"</span> <span class="op">=</span> <span class="va">a</span> <span class="op">*</span> <span class="va">b</span><span class="op">)</span></code></pre></div>
<pre><code>##   a  b c
## 1 1 11 2
## 2 2 12 2
## 3 3 13 2
## 4 4 14 2
## 5 5 15 2
## 6 6 16 2
## 7 7 17 2</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 3</strong>: define un <code>tibble</code> con tres variables de nombres <code>variable</code>, <code>2</code>, <code>tercera :)</code>, e intenta acceder a ellas.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<p>Las variables solo con caracteres del alfabeto se podrán acceder sin necesidad de comillas.</p>
<div class="sourceCode" id="cb751"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Definimos el tibble</span>
<span class="va">datos_tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble</a></span><span class="op">(</span><span class="st">"variable"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, <span class="st">"tercera falsa :)"</span> <span class="op">=</span> <span class="fl">0</span>,
                   <span class="st">"2"</span> <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">17</span><span class="op">)</span>

<span class="co"># Accedemos a sus columnas</span>
<span class="va">datos_tb</span><span class="op">$</span><span class="va">variable</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6 7</code></pre>
<div class="sourceCode" id="cb753"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos_tb</span><span class="op">$</span><span class="va">`tercera falsa :)`</span></code></pre></div>
<pre><code>## [1] 0 0 0 0 0 0 0</code></pre>
<div class="sourceCode" id="cb755"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos_tb</span><span class="op">$</span><span class="va">`2`</span></code></pre></div>
<pre><code>## [1] 11 12 13 14 15 16 17</code></pre>
<p>También se puede acceder por el orden que ocupan:</p>
<div class="sourceCode" id="cb757"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos_tb</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></code></pre></div>
<pre><code>## # A tibble: 7 × 1
##   variable
##      &lt;int&gt;
## 1        1
## 2        2
## 3        3
## 4        4
## 5        5
## 6        6
## 7        7</code></pre>
<div class="sourceCode" id="cb759"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos_tb</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></code></pre></div>
<pre><code>## # A tibble: 7 × 1
##   `tercera falsa :)`
##                &lt;dbl&gt;
## 1                  0
## 2                  0
## 3                  0
## 4                  0
## 5                  0
## 6                  0
## 7                  0</code></pre>
<div class="sourceCode" id="cb761"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos_tb</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></code></pre></div>
<pre><code>## # A tibble: 7 × 1
##     `2`
##   &lt;int&gt;
## 1    11
## 2    12
## 3    13
## 4    14
## 5    15
## 6    16
## 7    17</code></pre>
<p>Y también por el nombre entre corchetes (doble corchete extrae la variable fuera del tibble, corchete simple en formato tibble):</p>
<div class="sourceCode" id="cb763"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos_tb</span><span class="op">[</span><span class="st">"variable"</span><span class="op">]</span></code></pre></div>
<pre><code>## # A tibble: 7 × 1
##   variable
##      &lt;int&gt;
## 1        1
## 2        2
## 3        3
## 4        4
## 5        5
## 6        6
## 7        7</code></pre>
<div class="sourceCode" id="cb765"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos_tb</span><span class="op">[[</span><span class="st">"variable"</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6 7</code></pre>
<div class="sourceCode" id="cb767"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos_tb</span><span class="op">[</span><span class="st">"tercera falsa :)"</span><span class="op">]</span></code></pre></div>
<pre><code>## # A tibble: 7 × 1
##   `tercera falsa :)`
##                &lt;dbl&gt;
## 1                  0
## 2                  0
## 3                  0
## 4                  0
## 5                  0
## 6                  0
## 7                  0</code></pre>
<div class="sourceCode" id="cb769"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datos_tb</span><span class="op">[</span><span class="st">"2"</span><span class="op">]</span></code></pre></div>
<pre><code>## # A tibble: 7 × 1
##     `2`
##   &lt;int&gt;
## 1    11
## 2    12
## 3    13
## 4    14
## 5    15
## 6    16
## 7    17</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 4</strong>: convierte en <em>tidy data</em> el siguiente <code>data.frame</code>.</summary></p>
<div class="sourceCode" id="cb771"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tabla_tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble</a></span><span class="op">(</span><span class="st">"trimestre"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"T1"</span>, <span class="st">"T2"</span>, <span class="st">"T3"</span><span class="op">)</span>,
                   <span class="st">"2020"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span>, <span class="fl">7.5</span><span class="op">)</span>,
                   <span class="st">"2021"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">0</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<p>El problema es que las dos columnas con nombres de año son en realidad valores que deberían pasar a ser variables, así que deberíamos disminuir aplicar <code>pivot_longer()</code></p>
<div class="sourceCode" id="cb772"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Aplicamos pivot_longer</span>
<span class="va">tabla_tb</span> <span class="op">%&gt;%</span> <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020"</span>, <span class="st">"2021"</span><span class="op">)</span>,
                          names_to <span class="op">=</span> <span class="st">"año"</span>, values_to <span class="op">=</span> <span class="st">"valores"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   trimestre año   valores
##   &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;
## 1 T1        2020     10  
## 2 T1        2021      8  
## 3 T2        2020     12  
## 4 T2        2021      0  
## 5 T3        2020      7.5
## 6 T3        2021      9</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 5</strong>: convierte en <em>tidy data</em> el siguiente <code>data.frame</code>.</summary></p>
<div class="sourceCode" id="cb774"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tabla_tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble</a></span><span class="op">(</span><span class="st">"año"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">2019</span>, <span class="fl">2020</span>, <span class="fl">2020</span>, <span class="fl">2021</span>, <span class="fl">2021</span><span class="op">)</span>,
                   <span class="st">"variable"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,
                   <span class="st">"valor"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9383</span>, <span class="fl">7.58</span>, <span class="fl">10839</span>, <span class="fl">9</span>, <span class="fl">32949</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<p>El problema es que las filas que comparten año son el mismo registro (pero con dos características que tenemos divididas en dos filas), así que deberíamos disminuir aplicar <code>pivot_wider()</code></p>
<div class="sourceCode" id="cb775"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Aplicamos pivot_wider</span>
<span class="va">tabla_tb</span> <span class="op">%&gt;%</span> <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"variable"</span>, values_from <span class="op">=</span> <span class="st">"valor"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##     año     A     B
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  2019 10     9383
## 2  2020  7.58 10839
## 3  2021  9    32949</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 6</strong>: convierte en <em>tidy data</em> la tabla <code>table5</code> del paquete <a href="https://tidyr.tidyverse.org">tidyr</a>.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<p>Primero uniremos el siglo y las dos últimas cifras del año para obtener el año completo (guardado en <code>año</code>)</p>
<div class="sourceCode" id="cb777"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table5</span> <span class="op">%&gt;%</span>
  <span class="fu">unite</span><span class="op">(</span><span class="va">año</span>, <span class="va">century</span>, <span class="va">year</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   country     año   rate             
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;            
## 1 Afghanistan 1999  745/19987071     
## 2 Afghanistan 2000  2666/20595360    
## 3 Brazil      1999  37737/172006362  
## 4 Brazil      2000  80488/174504898  
## 5 China       1999  212258/1272915272
## 6 China       2000  213766/1280428583</code></pre>
<p>Tras ello deberemos separar el valor del ratio en denominador y numerador (ya que ahora hay dos valores en una celda), y convertiremos el tipo de dato en la salida para que sea número.</p>
<div class="sourceCode" id="cb779"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">table5</span> <span class="op">%&gt;%</span>
  <span class="fu">unite</span><span class="op">(</span><span class="va">año</span>, <span class="va">century</span>, <span class="va">year</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">separate</span><span class="op">(</span><span class="va">rate</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"numerador"</span>, <span class="st">"denominador"</span><span class="op">)</span>, convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country     año   numerador denominador
##   &lt;chr&gt;       &lt;chr&gt;     &lt;int&gt;       &lt;int&gt;
## 1 Afghanistan 1999        745    19987071
## 2 Afghanistan 2000       2666    20595360
## 3 Brazil      1999      37737   172006362
## 4 Brazil      2000      80488   174504898
## 5 China       1999     212258  1272915272
## 6 China       2000     213766  1280428583</code></pre>
<!-- tocstop -->
</details>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="resumen-1.html"><span class="header-section-number">10</span> ¿Qué sabemos hacer?</a></div>
<div class="next"><a href="tidyverse.html"><span class="header-section-number">12</span> Explorando los datos: incursión a tidyverse</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidydata"><span class="header-section-number">11</span> Tidy data: ordenando datos</a></li>
<li><a class="nav-link" href="#repaso_datos"><span class="header-section-number">11.1</span> Repaso: tipos de datos</a></li>
<li><a class="nav-link" href="#tibble"><span class="header-section-number">11.2</span> Mejorando los data.frame: datos tibble</a></li>
<li>
<a class="nav-link" href="#tidy"><span class="header-section-number">11.3</span> Tidy data vs messy data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#messy-data-valores-en-columnas-en-lugar-de-variables"><span class="header-section-number">11.3.1</span> Messy data: valores en columnas en lugar de variables</a></li>
<li><a class="nav-link" href="#messy-data-una-observaci%C3%B3n-guardada-en-varias-filas"><span class="header-section-number">11.3.2</span> Messy data: una observación guardada en varias filas</a></li>
<li><a class="nav-link" href="#messy-data-una-celda-con-m%C3%BAltiples-valores"><span class="header-section-number">11.3.3</span> Messy data: una celda con múltiples valores</a></li>
</ul>
</li>
<li><a class="nav-link" href="#ejercicios-6"><span class="header-section-number">11.4</span> 📝 Ejercicios</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/dadosdelaplace/cursoR_intro_2021_2022/blob/master/11-procesamiento_datos.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/dadosdelaplace/cursoR_intro_2021_2022/edit/master/11-procesamiento_datos.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Aprendiendo R sin morir en el intento</strong>" was written by Javier Álvarez Liébana. It was last built on Última actualización: 29-10-2021.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
