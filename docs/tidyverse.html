<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Capítulo 13 Explorando los datos: incursión a tidyverse | Aprendiendo R sin morir en el intento</title>
<meta name="author" content="Javier Álvarez Liébana">
<meta name="description" content="Empezamos a tener ciertas herramientas para trabajar con los datos: Intentaremos que nuestros datos sean Tidy data Conocemos un formato amable de almacenar los datos como son los data.frame de...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Capítulo 13 Explorando los datos: incursión a tidyverse | Aprendiendo R sin morir en el intento">
<meta property="og:type" content="book">
<meta property="og:image" content="/img/logo_R.png">
<meta property="og:description" content="Empezamos a tener ciertas herramientas para trabajar con los datos: Intentaremos que nuestros datos sean Tidy data Conocemos un formato amable de almacenar los datos como son los data.frame de...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Capítulo 13 Explorando los datos: incursión a tidyverse | Aprendiendo R sin morir en el intento">
<meta name="twitter:description" content="Empezamos a tener ciertas herramientas para trabajar con los datos: Intentaremos que nuestros datos sean Tidy data Conocemos un formato amable de almacenar los datos como son los data.frame de...">
<meta name="twitter:image" content="/img/logo_R.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Sen-0.4.0/font.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=DM%20Mono&amp;display=swap" rel="stylesheet">
<link href="libs/_Bitter-0.4.0/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.18/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Aprendiendo R sin morir en el intento</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prefacio</a></li>
<li class="book-part">Toma de contacto</li>
<li><a class="" href="instalacionR.html"><span class="header-section-number">1</span> Instalación</a></li>
<li><a class="" href="primeros-pasos.html"><span class="header-section-number">2</span> Primeros pasos</a></li>
<li class="book-part">Conceptos básicos</li>
<li><a class="" href="vectores.html"><span class="header-section-number">3</span> Tipos de datos I: vectores</a></li>
<li><a class="" href="operacionesvectores.html"><span class="header-section-number">4</span> Operaciones con vectores</a></li>
<li><a class="" href="proyecto.html"><span class="header-section-number">5</span> Flujo de trabajo: primer proyecto</a></li>
<li><a class="" href="control.html"><span class="header-section-number">6</span> Estructuras de control</a></li>
<li><a class="" href="datos.html"><span class="header-section-number">7</span> Tipos de datos II: datos estructurados</a></li>
<li><a class="" href="importar-exportar.html"><span class="header-section-number">8</span> Importando/exportando</a></li>
<li class="book-part">Listas y funciones</li>
<li><a class="" href="otros-datos.html"><span class="header-section-number">9</span> Listas y factores</a></li>
<li><a class="" href="funciones.html"><span class="header-section-number">10</span> Creación de funciones</a></li>
<li class="book-part">Alto en el camino</li>
<li><a class="" href="resumen-1.html"><span class="header-section-number">11</span> ¿Qué sabemos hacer?</a></li>
<li class="book-part">EXPLORANDO: introducción al análisis exploratorio de datos</li>
<li><a class="" href="tidydata.html"><span class="header-section-number">12</span> Tidy data: ordenando datos</a></li>
<li><a class="active" href="tidyverse.html"><span class="header-section-number">13</span> Explorando los datos: incursión a tidyverse</a></li>
<li><a class="" href="resumenes.html"><span class="header-section-number">14</span> Resumiendo y relacionado los datos</a></li>
<li><a class="" href="ggplot2.html"><span class="header-section-number">15</span> Visualizando datos: incursión a ggplot2</a></li>
<li class="book-part">Epílogo</li>
<li><a class="" href="contribuye.html"><span class="header-section-number">16</span> Contribuye al proyecto</a></li>
<li><a class="" href="bibliograf%C3%ADa.html">Bibliografía</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/dadosdelaplace/intro-R">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tidyverse" class="section level1">
<h1>
<span class="header-section-number">Capítulo 13</span> Explorando los datos: incursión a tidyverse<a class="anchor" aria-label="anchor" href="#tidyverse"><i class="fas fa-link"></i></a>
</h1>
<p>Empezamos a tener ciertas <strong>herramientas</strong> para trabajar con los datos:</p>
<ul>
<li>Intentaremos que nuestros datos sean <a href="#tidy_data">Tidy data</a>
</li>
<li>Conocemos un <strong>formato amable</strong> de almacenar los datos como son los <code>data.frame</code> de tipo <code>tibble</code>
</li>
</ul>
<p>Sin embargo muchas veces los datos no los tenemos en el formato deseado, o directamente queremos realizar algunas transformaciones en los mismos, crear nuevas variables u obtener resúmenes numéricos. En esta sección <strong>aprenderemos a explorar, procesar, depurar, transformar y analizar numéricamente los datos</strong>, haciendo uso principalmente de los paquetes <a href="https://tidyverse.tidyverse.org">tidyverse</a> y <a href="https://docs.ropensci.org/skimr/">skimr</a></p>
<div class="sourceCode" id="cb793"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/skimr/">skimr</a></span><span class="op">)</span></code></pre></div>
<p>El entorno <a href="https://tidyverse.tidyverse.org">tidyverse</a> es una de las <strong>herramientas más importantes en el manejo de datos en <code>R</code></strong>, una <strong>colección de paquetes</strong> pensada para el manejo, la exploración, el análisis y la visualización de datos, compartiendo una <strong>misma filosofía y gramática</strong>. Puedes ver su documentación en <a href="https://www.tidyverse.org/" class="uri">https://www.tidyverse.org/</a>. Esta sección pretende ser una <strong>introducción a dicho entorno</strong>, y lo haremos principalmente con el conjunto de datos <code>starwars</code>, del paquete <a href="https://dplyr.tidyverse.org">dplyr</a> (ya cargado en <a href="https://tidyverse.tidyverse.org">tidyverse</a>).</p>
<div class="sourceCode" id="cb794"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Dicho <strong>conjunto de datos</strong>, extraída de la <a href="https://swapi.dev">Star Wars API</a>, recopila diferentes datos y características de los personajes de la <strong>saga Star Wars</strong>. Como habrás advertido, <code>starwars</code> es una tabla en un formato ya conocido, un <code>tibble</code>, en el que se nos especifica al inicio de la tabla de qué tipo son cada columna:</p>
<ul>
<li>
<code>int</code>: números enteros.</li>
<li>
<code>dbl</code>: números reales (o racionales).</li>
<li>
<code>chr</code>: cadenas de texto.</li>
<li>
<code>lgl</code>: valores lógicos (<code>TRUE</code> o <code>FALSE</code>).</li>
<li>
<code>fct</code>: factores, variables cualitativas (categorías).</li>
<li>
<code>date</code>: fechas.</li>
</ul>
<p>Las <strong>funciones</strong> que veremos a lo largo de esta sección <strong>siempre van a compartir una misma metodología</strong>: primero escribimos el nombre una tabla (<code>data.frame</code> o <code>tibble</code>), después <strong>lo que queremos hacer</strong> a dicho conjunto de datos (con las variables SIN comillas) encandenando órdenes con <code><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></code> (lo que se conoce como <em>pipes</em>), y <strong>obtenemos una nueva tabla</strong> en el mismo formato de entrada.</p>
<div class="sourceCode" id="cb796"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Tipo de datos</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "tbl_df"     "tbl"        "data.frame"</code></pre>
<div class="sourceCode" id="cb798"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Dimensión de los datos</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 87 14</code></pre>
<div class="sourceCode" id="cb800"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Resumen por columnas</span>
<span class="fu"><a href="https://rdrr.io/pkg/pillar/man/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 87
## Columns: 14
## $ name       &lt;chr&gt; "Luke Skywalker", "C-3PO", "R2-D2", "Darth Vader", "Leia Or…
## $ height     &lt;int&gt; 172, 167, 96, 202, 150, 178, 165, 97, 183, 182, 188, 180, 2…
## $ mass       &lt;dbl&gt; 77.0, 75.0, 32.0, 136.0, 49.0, 120.0, 75.0, 32.0, 84.0, 77.…
## $ hair_color &lt;chr&gt; "blond", NA, NA, "none", "brown", "brown, grey", "brown", N…
## $ skin_color &lt;chr&gt; "fair", "gold", "white, blue", "white", "light", "light", "…
## $ eye_color  &lt;chr&gt; "blue", "yellow", "red", "yellow", "brown", "blue", "blue",…
## $ birth_year &lt;dbl&gt; 19.0, 112.0, 33.0, 41.9, 19.0, 52.0, 47.0, NA, 24.0, 57.0, …
## $ sex        &lt;chr&gt; "male", "none", "none", "male", "female", "male", "female",…
## $ gender     &lt;chr&gt; "masculine", "masculine", "masculine", "masculine", "femini…
## $ homeworld  &lt;chr&gt; "Tatooine", "Tatooine", "Naboo", "Tatooine", "Alderaan", "T…
## $ species    &lt;chr&gt; "Human", "Droid", "Droid", "Human", "Human", "Human", "Huma…
## $ films      &lt;list&gt; &lt;"The Empire Strikes Back", "Revenge of the Sith", "Return…
## $ vehicles   &lt;list&gt; &lt;"Snowspeeder", "Imperial Speeder Bike"&gt;, &lt;&gt;, &lt;&gt;, &lt;&gt;, "Imp…
## $ starships  &lt;list&gt; &lt;"X-wing", "Imperial shuttle"&gt;, &lt;&gt;, &lt;&gt;, "TIE Advanced x1",…</code></pre>
<p>Los datos podemos verlos escribiendo el nombre de la tabla en la consola (recuerda que si es un <code>tibble</code>, para evitar saturar la consola, te saca un extracto, no todas las columnas y filas) o bien con la <strong>función <code><a href="https://docs.ropensci.org/skimr/reference/print.html">print()</a></code>, indicándole número de filas (<code>n = 15</code> por ejemplo) y número de columnas (<code>width = Inf</code> si queremos mostrar todas)</strong>.</p>
<div class="sourceCode" id="cb802"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Imprimir personalizado</span>
<span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">starwars</span>, n <span class="op">=</span> <span class="fl">5</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##   name           height  mass hair_color skin_color  eye_color birth_year sex   
##   &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; 
## 1 Luke Skywalker    172    77 blond      fair        blue            19   male  
## 2 C-3PO             167    75 &lt;NA&gt;       gold        yellow         112   none  
## 3 R2-D2              96    32 &lt;NA&gt;       white, blue red             33   none  
## 4 Darth Vader       202   136 none       white       yellow          41.9 male  
## 5 Leia Organa       150    49 brown      light       brown           19   female
##   gender    homeworld species films     vehicles  starships
##   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
## 1 masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
## 2 masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
## 3 masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
## 4 masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 5 feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
## # … with 82 more rows</code></pre>
<p>Fíjate que las <strong>3 últimas variables son de tipo lista</strong> (echa un vistazo a <a href="otros-datos.html#otros-datos">Listas y Factores</a>). Por ejemplo, en <code>starwars$films</code> se <strong>guardan para cada personaje la colección de películas de la saga</strong> en las que aparece (algunos tendrán 1 solo nombre, otros 7).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:dplyr"></span>
<img src="img/dplyr.png" alt="Cheet sheet de las opciones del paquete dplyr para la manipulación de datos extraída de &lt;https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf&gt;" width="80%"><p class="caption">
Imagen/gráfica 13.1: Cheet sheet de las opciones del paquete dplyr para la manipulación de datos extraída de <a href="https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf" class="uri">https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf</a>
</p>
</div>
<div id="operaciones-con-filas" class="section level2">
<h2>
<span class="header-section-number">13.1</span> Operaciones con filas<a class="anchor" aria-label="anchor" href="#operaciones-con-filas"><i class="fas fa-link"></i></a>
</h2>
<p>Empecemos por <strong>cómo seleccionar filas</strong>. Principalmente tenemos tres opciones: seleccionarlas en base a algún <strong>filtro o condición</strong> (solo los mayores de tal edad, por ejemplo), <strong>extraer filas por su índice</strong> de fila o <strong>extraer filas aleatoriamente</strong>.</p>
<div id="seleccionar-filas-filter-slice" class="section level3">
<h3>
<span class="header-section-number">13.1.1</span> Seleccionar filas (filter, slice)<a class="anchor" aria-label="anchor" href="#seleccionar-filas-filter-slice"><i class="fas fa-link"></i></a>
</h3>
<p>La función <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> nos permite <strong>seleccionar filas en base a que se cumpla una o varias condiciones</strong> respecto a las variables. Para usarla basta con que introduzcamos como argumento el conjunto de condiciones que debe cumplir (recuerda: nombre de columnas sin comillas). Supongamos que queremos por ejemplo <strong>seleccionar solo los personajes con ojos marrones</strong>.</p>
<div class="sourceCode" id="cb804"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">eye_color</span> <span class="op">==</span> <span class="st">"brown"</span><span class="op">)</span> <span class="co"># con ojos marrones</span></code></pre></div>
<pre><code>## # A tibble: 21 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Leia Or…    150  49   brown      light      brown           19   fema… femin…
##  2 Biggs D…    183  84   black      light      brown           24   male  mascu…
##  3 Han Solo    180  80   brown      fair       brown           29   male  mascu…
##  4 Yoda         66  17   white      green      brown          896   male  mascu…
##  5 Boba Fe…    183  78.2 black      fair       brown           31.5 male  mascu…
##  6 Lando C…    177  79   black      dark       brown           31   male  mascu…
##  7 Arvel C…     NA  NA   brown      fair       brown           NA   male  mascu…
##  8 Wicket …     88  20   brown      brown      brown            8   male  mascu…
##  9 Quarsh …    183  NA   black      dark       brown           62   &lt;NA&gt;  &lt;NA&gt;  
## 10 Shmi Sk…    163  NA   black      fair       brown           72   fema… femin…
## # … with 11 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>En tan solo una línea hemos hecho más de lo que parece: <code>R</code> ha «recorrido» cada una de las filas y ha ido comprobando que fila cumple la condición y cual no. Con la misma lógica podemos <strong>seleccionar los personajes que NO TIENEN ojos marrones</strong>, cambiando <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code> por <code><a href="https://rdrr.io/r/base/Comparison.html">!=</a></code></p>
<div class="sourceCode" id="cb806"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">eye_color</span> <span class="op">!=</span> <span class="st">"brown"</span><span class="op">)</span> <span class="co"># NO tengan ojos marrones</span></code></pre></div>
<pre><code>## # A tibble: 66 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  6 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  7 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  8 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
##  9 Anakin…    188    84 blond       fair       blue            41.9 male  mascu…
## 10 Wilhuf…    180    NA auburn, gr… fair       blue            64   male  mascu…
## # … with 56 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>También se pueden <strong>seleccionar los personajes que tienen los ojos de una serie de colores permitidos</strong>.</p>
<div class="sourceCode" id="cb808"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># con ojos marrones, azules o rojos</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">eye_color</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 45 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  3 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  4 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  5 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  6 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  7 Biggs …    183    84 black       light      brown           24   male  mascu…
##  8 Anakin…    188    84 blond       fair       blue            41.9 male  mascu…
##  9 Wilhuf…    180    NA auburn, gr… fair       blue            64   male  mascu…
## 10 Chewba…    228   112 brown       unknown    blue           200   male  mascu…
## # … with 35 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Si es una <strong>variable numérica</strong> también podemos <strong>seleccionar por rango</strong> con <code>between()</code>, por ejemplo, los personajes cuya altura está entre 120 y 160 cm.</p>
<div class="sourceCode" id="cb810"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Con between filtramos por rango</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">between</span><span class="op">(</span><span class="va">height</span>, <span class="fl">120</span>, <span class="fl">160</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   name     height  mass hair_color skin_color eye_color birth_year sex   gender 
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  
## 1 Leia Or…    150    49 brown      light      brown             19 fema… femini…
## 2 Mon Mot…    150    NA auburn     fair       blue              48 fema… femini…
## 3 Nien Nu…    160    68 none       grey       black             NA male  mascul…
## 4 Watto       137    NA black      blue, grey yellow            NA male  mascul…
## 5 Gasgano     122    NA none       white, bl… black             NA male  mascul…
## 6 Cordé       157    NA brown      light      brown             NA fema… femini…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Las <strong>condiciones se pueden concatenar y complejizar</strong> todo lo que queramos, pudiendo en pocas líneas realizar un <strong>filtro complejo</strong></p>
<div class="sourceCode" id="cb812"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># humanos con ojos marrones</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">eye_color</span> <span class="op">==</span> <span class="st">"brown"</span>, <span class="va">species</span> <span class="op">==</span> <span class="st">"Human"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 17 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Leia Or…    150  49   brown      light      brown           19   fema… femin…
##  2 Biggs D…    183  84   black      light      brown           24   male  mascu…
##  3 Han Solo    180  80   brown      fair       brown           29   male  mascu…
##  4 Boba Fe…    183  78.2 black      fair       brown           31.5 male  mascu…
##  5 Lando C…    177  79   black      dark       brown           31   male  mascu…
##  6 Arvel C…     NA  NA   brown      fair       brown           NA   male  mascu…
##  7 Shmi Sk…    163  NA   black      fair       brown           72   fema… femin…
##  8 Mace Wi…    188  84   none       dark       brown           72   male  mascu…
##  9 Gregar …    185  85   black      dark       brown           NA   male  mascu…
## 10 Cordé       157  NA   brown      light      brown           NA   fema… femin…
## 11 Dormé       165  NA   brown      light      brown           NA   fema… femin…
## 12 Dooku       193  80   white      fair       brown          102   male  mascu…
## 13 Bail Pr…    191  NA   black      tan        brown           67   male  mascu…
## 14 Jango F…    183  79   black      tan        brown           66   male  mascu…
## 15 Raymus …    188  79   brown      light      brown           NA   male  mascu…
## 16 Poe Dam…     NA  NA   brown      light      brown           NA   male  mascu…
## 17 Padmé A…    165  45   brown      light      brown           46   fema… femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb814"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># humanos con ojos marrones, azules o rojos, que no sean humanos, y menos de 50a</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">eye_color</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>,
         <span class="va">species</span> <span class="op">!=</span> <span class="st">"Human"</span>, <span class="va">birth_year</span> <span class="op">&lt;</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 R2-D2         96    32 &lt;NA&gt;       white, bl… red               33 none  mascu…
## 2 IG-88        200   140 none       metal      red               15 none  mascu…
## 3 Wicket S…     88    20 brown      brown      brown              8 male  mascu…
## 4 Barriss …    166    50 black      yellow     blue              40 fema… femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Muchas veces querremos <strong>extraer filas simplemente por el lugar que ocupan, sin hacer que dependa de ninguna condición</strong>. Vamos a extraer las filas quinta, sexta, séptima, octava, novena y décima.</p>
<div class="sourceCode" id="cb816"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># slice: extramos filas por índice de fila.</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">slice</span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="co"># filas de la 5 a la 10</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Leia Or…    150    49 brown       light      brown             19 fema… femin…
## 2 Owen La…    178   120 brown, grey light      blue              52 male  mascu…
## 3 Beru Wh…    165    75 brown       light      blue              47 fema… femin…
## 4 R5-D4        97    32 &lt;NA&gt;        white, red red               NA none  mascu…
## 5 Biggs D…    183    84 black       light      brown             24 male  mascu…
## 6 Obi-Wan…    182    77 auburn, wh… fair       blue-gray         57 male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Podemos <strong>combinar los índices</strong> para extraer por ejemplo solo los pares o filas concretas separadas por los espacios que queramos.</p>
<div class="sourceCode" id="cb818"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">slice</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># filas pares</span></code></pre></div>
<pre><code>## # A tibble: 43 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  2 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  3 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  4 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  5 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
##  6 Wilhuf…    180    NA auburn, gr… fair       blue            64   male  mascu…
##  7 Han So…    180    80 brown       fair       brown           29   male  mascu…
##  8 Jabba …    175  1358 &lt;NA&gt;        green-tan… orange         600   herm… mascu…
##  9 Jek To…    180   110 brown       fair       blue            NA   male  mascu…
## 10 Palpat…    170    75 grey        pale       yellow          82   male  mascu…
## # … with 33 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb820"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">slice</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">33</span><span class="op">)</span><span class="op">)</span> <span class="co"># filas 3, 4, 10, 20 y 33</span></code></pre></div>
<pre><code>## # A tibble: 5 × 14
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 R2-D2        96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
## 2 Darth V…    202   136 none        white      yellow          41.9 male  mascu…
## 3 Obi-Wan…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## 4 Palpati…    170    75 grey        pale       yellow          82   male  mascu…
## 5 Finis V…    170    NA blond       fair       blue            91   male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>También hay opciones por defecto para extraer directamente <strong>las primeras o últimas filas</strong> con <code>slice_head()</code> y <code>slice_tail()</code>.</p>
<div class="sourceCode" id="cb822"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Podemos extraer directamente las primeras o últimas filas</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="co"># 7 primeras filas </span></code></pre></div>
<pre><code>## # A tibble: 7 × 14
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Luke Sk…    172    77 blond       fair       blue            19   male  mascu…
## 2 C-3PO       167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
## 3 R2-D2        96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
## 4 Darth V…    202   136 none        white      yellow          41.9 male  mascu…
## 5 Leia Or…    150    49 brown       light      brown           19   fema… femin…
## 6 Owen La…    178   120 brown, grey light      blue            52   male  mascu…
## 7 Beru Wh…    165    75 brown       light      blue            47   fema… femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb824"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">slice_tail</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co"># 3 últimas filas </span></code></pre></div>
<pre><code>## # A tibble: 3 × 14
##   name     height  mass hair_color skin_color eye_color birth_year sex    gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; 
## 1 BB8          NA    NA none       none       black             NA none   mascu…
## 2 Captain…     NA    NA unknown    unknown    unknown           NA &lt;NA&gt;   &lt;NA&gt;  
## 3 Padmé A…    165    45 brown      light      brown             46 female femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Una opción también habitual es querer <strong>extraer un número de filas pero AL AZAR</strong>, pudiendo hacerlo sin reemplazamiento (una vez extraída, no se puede volver a extraer) o con reemplazamiento (<code>replace = TRUE</code>).</p>
<div class="sourceCode" id="cb826"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># También podemos hacer una extracción al azar de filas</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># 5 al azar</span></code></pre></div>
<pre><code>## # A tibble: 5 × 14
##   name     height  mass hair_color skin_color  eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Yoda         66    17 white      green       brown            896 male  mascu…
## 2 Poggle …    183    80 none       green       yellow            NA male  mascu…
## 3 Nute Gu…    191    90 none       mottled gr… red               NA male  mascu…
## 4 Jocasta…    167    NA white      fair        blue              NA fema… femin…
## 5 Arvel C…     NA    NA brown      fair        brown             NA male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb828"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># 100 con reemplazamiento</span></code></pre></div>
<pre><code>## # A tibble: 100 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Nien Nu…    160    68 none       grey       black             NA male  mascu…
##  2 Ayla Se…    178    55 none       blue       hazel             48 fema… femin…
##  3 Tarfful     234   136 brown      brown      blue              NA male  mascu…
##  4 Owen La…    178   120 brown, gr… light      blue              52 male  mascu…
##  5 Bail Pr…    191    NA black      tan        brown             67 male  mascu…
##  6 Greedo      173    74 &lt;NA&gt;       green      black             44 male  mascu…
##  7 Ric Olié    183    NA brown      fair       blue              NA &lt;NA&gt;  &lt;NA&gt;  
##  8 Dud Bolt     94    45 none       blue, grey yellow            NA male  mascu…
##  9 Greedo      173    74 &lt;NA&gt;       green      black             44 male  mascu…
## 10 R5-D4        97    32 &lt;NA&gt;       white, red red               NA none  mascu…
## # … with 90 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Por último, tenemos <code>slice_min()</code> y <code>slice_max()</code> que nos permite <strong>extraer filas en función del mínimo y máximo de una variable</strong>. Por defecto, si hay empate, mostrará todas las filas (aunque supere el número <code>n</code> indicado), salvo que <code>with_ties = FALSE</code>, que decidirá en caso de empate cual mostrarte</p>
<div class="sourceCode" id="cb830"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Podemos extraer filas en función del mín/máx de una variable</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">slice_min</span><span class="op">(</span><span class="va">height</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># los 5 más bajitos</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Yoda          66    17 white      green      brown            896 male  mascu…
## 2 Ratts Ty…     79    15 none       grey, blue unknown           NA male  mascu…
## 3 Wicket S…     88    20 brown      brown      brown              8 male  mascu…
## 4 Dud Bolt      94    45 none       blue, grey yellow            NA male  mascu…
## 5 R2-D2         96    32 &lt;NA&gt;       white, bl… red               33 none  mascu…
## 6 R4-P17        96    NA none       silver, r… red, blue         NA none  femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb832"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># los 5 más bajitos (sin empates, exactamente 5)</span>
  <span class="fu">slice_min</span><span class="op">(</span><span class="va">height</span>, n <span class="op">=</span> <span class="fl">5</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </code></pre></div>
<pre><code>## # A tibble: 5 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Yoda          66    17 white      green      brown            896 male  mascu…
## 2 Ratts Ty…     79    15 none       grey, blue unknown           NA male  mascu…
## 3 Wicket S…     88    20 brown      brown      brown              8 male  mascu…
## 4 Dud Bolt      94    45 none       blue, grey yellow            NA male  mascu…
## 5 R2-D2         96    32 &lt;NA&gt;       white, bl… red               33 none  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb834"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">slice_max</span><span class="op">(</span><span class="va">mass</span>, n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="co"># los 7 más pesados</span></code></pre></div>
<pre><code>## # A tibble: 7 × 14
##   name    height  mass hair_color  skin_color  eye_color birth_year sex   gender
##   &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Jabba …    175  1358 &lt;NA&gt;        green-tan,… orange         600   herm… mascu…
## 2 Grievo…    216   159 none        brown, whi… green, y…       NA   male  mascu…
## 3 IG-88      200   140 none        metal       red             15   none  mascu…
## 4 Darth …    202   136 none        white       yellow          41.9 male  mascu…
## 5 Tarfful    234   136 brown       brown       blue            NA   male  mascu…
## 6 Owen L…    178   120 brown, grey light       blue            52   male  mascu…
## 7 Bossk      190   113 none        green       red             53   male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
<div id="reordenar-filas-arrange" class="section level3">
<h3>
<span class="header-section-number">13.1.2</span> Reordenar filas (arrange)<a class="anchor" aria-label="anchor" href="#reordenar-filas-arrange"><i class="fas fa-link"></i></a>
</h3>
<p>Muchas veces necesitamos las <strong>filas ordenadas en función del valor de alguna de las variables</strong>. Para ello tenemos la función <code>arrange()</code> sin más que pasarle como argumento el nombre de la variable que usaremos para la ordenación</p>
<div class="sourceCode" id="cb836"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Con arrange ordenamos en base al orden de la variable que introduzcamos</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">height</span><span class="op">)</span> <span class="co"># de bajitos a altos, yoda al poder</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Yoda         66    17 white      green      brown            896 male  mascu…
##  2 Ratts T…     79    15 none       grey, blue unknown           NA male  mascu…
##  3 Wicket …     88    20 brown      brown      brown              8 male  mascu…
##  4 Dud Bolt     94    45 none       blue, grey yellow            NA male  mascu…
##  5 R2-D2        96    32 &lt;NA&gt;       white, bl… red               33 none  mascu…
##  6 R4-P17       96    NA none       silver, r… red, blue         NA none  femin…
##  7 R5-D4        97    32 &lt;NA&gt;       white, red red               NA none  mascu…
##  8 Sebulba     112    40 none       grey, red  orange            NA male  mascu…
##  9 Gasgano     122    NA none       white, bl… black             NA male  mascu…
## 10 Watto       137    NA black      blue, grey yellow            NA male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Por defecto la <strong>ordenación es de menor a mayor</strong> pero <strong>podemos invertirlo</strong> usando <code>desc()</code>.</p>
<div class="sourceCode" id="cb838"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Por defecto lo hace ascendente pero podemos cambiarlo</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    height  mass hair_color skin_color  eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Yarael…    264    NA none       white       yellow          NA   male  mascu…
##  2 Tarfful    234   136 brown      brown       blue            NA   male  mascu…
##  3 Lama Su    229    88 none       grey        black           NA   male  mascu…
##  4 Chewba…    228   112 brown      unknown     blue           200   male  mascu…
##  5 Roos T…    224    82 none       grey        orange          NA   male  mascu…
##  6 Grievo…    216   159 none       brown, whi… green, y…       NA   male  mascu…
##  7 Taun We    213    NA none       grey        black           NA   fema… femin…
##  8 Rugor …    206    NA none       green       orange          NA   male  mascu…
##  9 Tion M…    206    80 none       grey        black           NA   male  mascu…
## 10 Darth …    202   136 none       white       yellow          41.9 male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>La ordenación puede realizarse <strong>en base al valor de dos o más variables</strong>: ordenará las filas en base a la primera, en caso de empate usará la segunda, en caso de empate la tercera, y así sucesivamente.</p>
<div class="sourceCode" id="cb840"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Podemos combinar varios criterios: ordenados de bajitos a altos,</span>
<span class="co"># y en caso de empate, de pesados a ligeros. Un dato NA va siempre al final</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">height</span>, <span class="fu">desc</span><span class="op">(</span><span class="va">mass</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Yoda         66    17 white      green      brown            896 male  mascu…
##  2 Ratts T…     79    15 none       grey, blue unknown           NA male  mascu…
##  3 Wicket …     88    20 brown      brown      brown              8 male  mascu…
##  4 Dud Bolt     94    45 none       blue, grey yellow            NA male  mascu…
##  5 R2-D2        96    32 &lt;NA&gt;       white, bl… red               33 none  mascu…
##  6 R4-P17       96    NA none       silver, r… red, blue         NA none  femin…
##  7 R5-D4        97    32 &lt;NA&gt;       white, red red               NA none  mascu…
##  8 Sebulba     112    40 none       grey, red  orange            NA male  mascu…
##  9 Gasgano     122    NA none       white, bl… black             NA male  mascu…
## 10 Watto       137    NA black      blue, grey yellow            NA male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p> </p>
<p><strong><span style="color: #ffc107;">WARNING: valores ausentes</span></strong></p>
<p>Si te fijas los <strong><span style="color: #ffc107;">valores ausentes van siempre al final</span></strong> de la ordenación. Luego veremos como eliminarlos si quisiéramos.</p>
<p> </p>
<p>Como estarás imaginando <strong>podemos combinar varias acciones en pocas líneas</strong>, filtrando datos a la vez que ordenamos el filtro resultante.</p>
<div class="sourceCode" id="cb842"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Podemos combinar varias acciones en pocas líneas:</span>
<span class="co"># seleccionamos humanos, hombres, de ojos marrones</span>
<span class="co"># y en orden altura descendente y peso ascendente</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">eye_color</span> <span class="op">==</span> <span class="st">"brown"</span>, <span class="va">species</span> <span class="op">==</span> <span class="st">"Human"</span>, <span class="va">sex</span> <span class="op">==</span> <span class="st">"male"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">height</span>, <span class="fu">desc</span><span class="op">(</span><span class="va">mass</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 12 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Lando C…    177  79   black      dark       brown           31   male  mascu…
##  2 Han Solo    180  80   brown      fair       brown           29   male  mascu…
##  3 Biggs D…    183  84   black      light      brown           24   male  mascu…
##  4 Jango F…    183  79   black      tan        brown           66   male  mascu…
##  5 Boba Fe…    183  78.2 black      fair       brown           31.5 male  mascu…
##  6 Gregar …    185  85   black      dark       brown           NA   male  mascu…
##  7 Mace Wi…    188  84   none       dark       brown           72   male  mascu…
##  8 Raymus …    188  79   brown      light      brown           NA   male  mascu…
##  9 Bail Pr…    191  NA   black      tan        brown           67   male  mascu…
## 10 Dooku       193  80   white      fair       brown          102   male  mascu…
## 11 Arvel C…     NA  NA   brown      fair       brown           NA   male  mascu…
## 12 Poe Dam…     NA  NA   brown      light      brown           NA   male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
<div id="eliminar-filas.-eliminar-duplicados" class="section level3">
<h3>
<span class="header-section-number">13.1.3</span> Eliminar filas. Eliminar duplicados<a class="anchor" aria-label="anchor" href="#eliminar-filas.-eliminar-duplicados"><i class="fas fa-link"></i></a>
</h3>
<p>La misma lógica que hemos usado para <strong>seleccionar filas podemos usarla para eliminar filas</strong>, simplemente negando la condición de filtrado. Por ejemplo, vamos a <strong>eliminar las 5 primeras filas</strong>.</p>
<div class="sourceCode" id="cb844"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Eliminamos por índices</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">slice</span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="co"># eliminamos las 5 primeras filas</span></code></pre></div>
<pre><code>## # A tibble: 82 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  2 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  3 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  4 Biggs …    183    84 black       light      brown           24   male  mascu…
##  5 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
##  6 Anakin…    188    84 blond       fair       blue            41.9 male  mascu…
##  7 Wilhuf…    180    NA auburn, gr… fair       blue            64   male  mascu…
##  8 Chewba…    228   112 brown       unknown    blue           200   male  mascu…
##  9 Han So…    180    80 brown       fair       brown           29   male  mascu…
## 10 Greedo     173    74 &lt;NA&gt;        green      black           44   male  mascu…
## # … with 72 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Otra opción a la hora de eliminar filas es <strong>eliminar filas duplicadas (o filas con valores duplicados en alguna columna)</strong>. Para ello deberemos aplicar la función <code>distinct()</code>, con argumentos el nombre de las variables que usaremos para quitar duplicados.</p>
<div class="sourceCode" id="cb846"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Eliminamos duplicados</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># Eliminamos registros con igual par (color_pelo, color_ojos)</span>
  <span class="fu">distinct</span><span class="op">(</span><span class="va">hair_color</span>, <span class="va">eye_color</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 35 × 2
##    hair_color    eye_color
##    &lt;chr&gt;         &lt;chr&gt;    
##  1 blond         blue     
##  2 &lt;NA&gt;          yellow   
##  3 &lt;NA&gt;          red      
##  4 none          yellow   
##  5 brown         brown    
##  6 brown, grey   blue     
##  7 brown         blue     
##  8 black         brown    
##  9 auburn, white blue-gray
## 10 auburn, grey  blue     
## # … with 25 more rows</code></pre>
<p>Si te fijas además nos ha extraído las dos columnas en base a las cuales hemos eliminado duplicados. Si queremos que nos mantenga toda la tabla deberemos explicitarlo con <code>.keep_all = TRUE</code>.</p>
<div class="sourceCode" id="cb848"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Eliminamos duplicados</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># Eliminamos registros con igual par (color_pelo, color_ojos)</span>
  <span class="fu">distinct</span><span class="op">(</span><span class="va">hair_color</span>, <span class="va">eye_color</span>,
           .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># .keep_all = TRUE mantiene todas columnas</span></code></pre></div>
<pre><code>## # A tibble: 35 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 Biggs …    183    84 black       light      brown           24   male  mascu…
##  9 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## 10 Wilhuf…    180    NA auburn, gr… fair       blue            64   male  mascu…
## # … with 25 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Si no incluimos <strong>ningún nombre</strong> de columna <strong>nos eliminará solo los registros que tengan TODOS los campos duplicados</strong>.</p>
<div class="sourceCode" id="cb850"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Duplicamos el conjunto para probarlo</span>
<span class="va">duplicado_starwars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">starwars</span>, <span class="va">starwars</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">duplicado_starwars</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 174  14</code></pre>
<div class="sourceCode" id="cb852"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Eliminamos duplicados (filas exactamente iguales)</span>
<span class="va">duplicado_starwars</span> <span class="op">%&gt;%</span> <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb854"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">duplicado_starwars</span> <span class="op">%&gt;%</span> <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 87 14</code></pre>
</div>
</div>
<div id="operaciones-con-columnas" class="section level2">
<h2>
<span class="header-section-number">13.2</span> Operaciones con columnas<a class="anchor" aria-label="anchor" href="#operaciones-con-columnas"><i class="fas fa-link"></i></a>
</h2>
<p>Ya hemos visto algunas opciones para manejar filas. Pasemos a <strong>seleccionar columnas</strong> o <strong>construir columnas/variables nuevas</strong> en base a las ya existentes.</p>
<div id="seleccionar-select-y-extraer-pull-columnas" class="section level3">
<h3>
<span class="header-section-number">13.2.1</span> Seleccionar (select) y extraer (pull) columnas<a class="anchor" aria-label="anchor" href="#seleccionar-select-y-extraer-pull-columnas"><i class="fas fa-link"></i></a>
</h3>
<p>La opción más sencilla es usar la función <code>select()</code> pasándole como argumentos los nombres de columnas (¡SIN COMILLAS!) queremos seleccionar.</p>
<div class="sourceCode" id="cb856"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># select: columnas a seleccionar sin comillas</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># seleccionamos solo 3 columnas: pelo, piel y ojos</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">hair_color</span>, <span class="va">skin_color</span>, <span class="va">eye_color</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    hair_color    skin_color  eye_color
##    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 blond         fair        blue     
##  2 &lt;NA&gt;          gold        yellow   
##  3 &lt;NA&gt;          white, blue red      
##  4 none          white       yellow   
##  5 brown         light       brown    
##  6 brown, grey   light       blue     
##  7 brown         light       blue     
##  8 &lt;NA&gt;          white, red  red      
##  9 black         light       brown    
## 10 auburn, white fair        blue-gray
## # … with 77 more rows</code></pre>
<p>Si las columnas a seleccionar sabemos que son consecutivas, podemos indicarle que las seleccionemos desde una <strong>columna inicial hasta una columna inicial</strong> pasando por todas.</p>
<div class="sourceCode" id="cb858"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Podemos seleccionar columnas en orden: desde nombre hasta año nacim.</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">name</span><span class="op">:</span><span class="va">birth_year</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 7
##    name               height  mass hair_color    skin_color eye_color birth_year
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 Luke Skywalker        172    77 blond         fair       blue            19  
##  2 C-3PO                 167    75 &lt;NA&gt;          gold       yellow         112  
##  3 R2-D2                  96    32 &lt;NA&gt;          white, bl… red             33  
##  4 Darth Vader           202   136 none          white      yellow          41.9
##  5 Leia Organa           150    49 brown         light      brown           19  
##  6 Owen Lars             178   120 brown, grey   light      blue            52  
##  7 Beru Whitesun lars    165    75 brown         light      blue            47  
##  8 R5-D4                  97    32 &lt;NA&gt;          white, red red             NA  
##  9 Biggs Darklighter     183    84 black         light      brown           24  
## 10 Obi-Wan Kenobi        182    77 auburn, white fair       blue-gray       57  
## # … with 77 more rows</code></pre>
<p>Una de las mejores opciones en este entorno es que las columnas las podemos seleccionar a través de expresiones regulares, por ejemplo, <strong>seleccionando solo aquellas columnas que compartan un sufijo común en el nombre</strong>, con <code><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">ends_with()</a></code> dentro de órdenes como <code>select()</code></p>
<div class="sourceCode" id="cb860"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Podemos seleccionar columnas por sufijo y prefijo</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"color"</span><span class="op">)</span><span class="op">)</span> <span class="co"># acaban en "color"</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    hair_color    skin_color  eye_color
##    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 blond         fair        blue     
##  2 &lt;NA&gt;          gold        yellow   
##  3 &lt;NA&gt;          white, blue red      
##  4 none          white       yellow   
##  5 brown         light       brown    
##  6 brown, grey   light       blue     
##  7 brown         light       blue     
##  8 &lt;NA&gt;          white, red  red      
##  9 black         light       brown    
## 10 auburn, white fair        blue-gray
## # … with 77 more rows</code></pre>
<p>De una manera similar podemos <strong>seleccionar columnas cuyo nombre empiecen o contengan</strong> alguna cadena de texto concreta</p>
<div class="sourceCode" id="cb862"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"h"</span><span class="op">)</span><span class="op">)</span> <span class="co"># empiezan por h</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    height hair_color    homeworld
##     &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;    
##  1    172 blond         Tatooine 
##  2    167 &lt;NA&gt;          Tatooine 
##  3     96 &lt;NA&gt;          Naboo    
##  4    202 none          Tatooine 
##  5    150 brown         Alderaan 
##  6    178 brown, grey   Tatooine 
##  7    165 brown         Tatooine 
##  8     97 &lt;NA&gt;          Tatooine 
##  9    183 black         Tatooine 
## 10    182 auburn, white Stewjon  
## # … with 77 more rows</code></pre>
<div class="sourceCode" id="cb864"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"h"</span><span class="op">)</span><span class="op">)</span> <span class="co"># contienen la h</span></code></pre></div>
<pre><code>## # A tibble: 87 × 6
##    height hair_color    birth_year homeworld vehicles  starships
##     &lt;int&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;     &lt;list&gt;    &lt;list&gt;   
##  1    172 blond               19   Tatooine  &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2    167 &lt;NA&gt;               112   Tatooine  &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3     96 &lt;NA&gt;                33   Naboo     &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4    202 none                41.9 Tatooine  &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5    150 brown               19   Alderaan  &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6    178 brown, grey         52   Tatooine  &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7    165 brown               47   Tatooine  &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8     97 &lt;NA&gt;                NA   Tatooine  &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9    183 black               24   Tatooine  &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10    182 auburn, white       57   Stewjon   &lt;chr [1]&gt; &lt;chr [5]&gt;
## # … with 77 more rows</code></pre>
<p>Todo lo que hemos usado para seleccionar lo podemos usar para <strong>eliminar columnas</strong></p>
<div class="sourceCode" id="cb866"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># seleccionamos todas menos 3 columnas: pelo, piel y ojos</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">hair_color</span>, <span class="va">skin_color</span>, <span class="va">eye_color</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 11
##    name    height  mass birth_year sex   gender homeworld species films vehicles
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;   &lt;lis&gt; &lt;list&gt;  
##  1 Luke S…    172    77       19   male  mascu… Tatooine  Human   &lt;chr… &lt;chr [2…
##  2 C-3PO      167    75      112   none  mascu… Tatooine  Droid   &lt;chr… &lt;chr [0…
##  3 R2-D2       96    32       33   none  mascu… Naboo     Droid   &lt;chr… &lt;chr [0…
##  4 Darth …    202   136       41.9 male  mascu… Tatooine  Human   &lt;chr… &lt;chr [0…
##  5 Leia O…    150    49       19   fema… femin… Alderaan  Human   &lt;chr… &lt;chr [1…
##  6 Owen L…    178   120       52   male  mascu… Tatooine  Human   &lt;chr… &lt;chr [0…
##  7 Beru W…    165    75       47   fema… femin… Tatooine  Human   &lt;chr… &lt;chr [0…
##  8 R5-D4       97    32       NA   none  mascu… Tatooine  Droid   &lt;chr… &lt;chr [0…
##  9 Biggs …    183    84       24   male  mascu… Tatooine  Human   &lt;chr… &lt;chr [0…
## 10 Obi-Wa…    182    77       57   male  mascu… Stewjon   Human   &lt;chr… &lt;chr [1…
## # … with 77 more rows, and 1 more variable: starships &lt;list&gt;</code></pre>
<p>Incluso nos permite <strong>seleccionar aquellas columnas que son del mismo tipo</strong> (imagina que necesitamos solo las columnas numéricas para calcular ciertas estadísticas).</p>
<div class="sourceCode" id="cb868"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Seleccionamos solo la columnas numéricas</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    height  mass birth_year
##     &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1    172    77       19  
##  2    167    75      112  
##  3     96    32       33  
##  4    202   136       41.9
##  5    150    49       19  
##  6    178   120       52  
##  7    165    75       47  
##  8     97    32       NA  
##  9    183    84       24  
## 10    182    77       57  
## # … with 77 more rows</code></pre>
<p>Por último, podemos no tanto seleccionar sino <strong>extraer columnas</strong>: las saca fuera de la tabla y las convierte en un vector fuera del <code>tibble</code>, con la función <code>pull()</code>.</p>
<div class="sourceCode" id="cb870"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">name</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "Luke Skywalker"        "C-3PO"                 "R2-D2"                
##  [4] "Darth Vader"           "Leia Organa"           "Owen Lars"            
##  [7] "Beru Whitesun lars"    "R5-D4"                 "Biggs Darklighter"    
## [10] "Obi-Wan Kenobi"        "Anakin Skywalker"      "Wilhuff Tarkin"       
## [13] "Chewbacca"             "Han Solo"              "Greedo"               
## [16] "Jabba Desilijic Tiure" "Wedge Antilles"        "Jek Tono Porkins"     
## [19] "Yoda"                  "Palpatine"             "Boba Fett"            
## [22] "IG-88"                 "Bossk"                 "Lando Calrissian"     
## [25] "Lobot"                 "Ackbar"                "Mon Mothma"           
## [28] "Arvel Crynyd"          "Wicket Systri Warrick" "Nien Nunb"            
## [31] "Qui-Gon Jinn"          "Nute Gunray"           "Finis Valorum"        
## [34] "Jar Jar Binks"         "Roos Tarpals"          "Rugor Nass"           
## [37] "Ric Olié"              "Watto"                 "Sebulba"              
## [40] "Quarsh Panaka"         "Shmi Skywalker"        "Darth Maul"           
## [43] "Bib Fortuna"           "Ayla Secura"           "Dud Bolt"             
## [46] "Gasgano"               "Ben Quadinaros"        "Mace Windu"           
## [49] "Ki-Adi-Mundi"          "Kit Fisto"             "Eeth Koth"            
## [52] "Adi Gallia"            "Saesee Tiin"           "Yarael Poof"          
## [55] "Plo Koon"              "Mas Amedda"            "Gregar Typho"         
## [58] "Cordé"                 "Cliegg Lars"           "Poggle the Lesser"    
## [61] "Luminara Unduli"       "Barriss Offee"         "Dormé"                
## [64] "Dooku"                 "Bail Prestor Organa"   "Jango Fett"           
## [67] "Zam Wesell"            "Dexter Jettster"       "Lama Su"              
## [70] "Taun We"               "Jocasta Nu"            "Ratts Tyerell"        
## [73] "R4-P17"                "Wat Tambor"            "San Hill"             
## [76] "Shaak Ti"              "Grievous"              "Tarfful"              
## [79] "Raymus Antilles"       "Sly Moore"             "Tion Medon"           
## [82] "Finn"                  "Rey"                   "Poe Dameron"          
## [85] "BB8"                   "Captain Phasma"        "Padmé Amidala"</code></pre>
</div>
<div id="renombrar-rename-y-reordenar-relocate-columnas" class="section level3">
<h3>
<span class="header-section-number">13.2.2</span> Renombrar (rename) y reordenar (relocate) columnas<a class="anchor" aria-label="anchor" href="#renombrar-rename-y-reordenar-relocate-columnas"><i class="fas fa-link"></i></a>
</h3>
<p>A veces también podemos querer <strong>modificar la «metainformación» de la tabla</strong>, no modificando los datos sino <strong>renombrando el orden de las columnas</strong>. Para ello debremos usar la función <code>rename()</code> poniendo primero el nombre nuevo y luego el antiguo</p>
<div class="sourceCode" id="cb872"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># rename: renombrar columnas, primero el nuevo y luego el antiguo</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">rename</span><span class="op">(</span>nombre <span class="op">=</span> <span class="va">name</span>, altura <span class="op">=</span> <span class="va">height</span>, peso <span class="op">=</span> <span class="va">mass</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    nombre   altura  peso hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…
##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
##  3 R2-D2        96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
##  4 Darth V…    202   136 none       white      yellow          41.9 male  mascu…
##  5 Leia Or…    150    49 brown      light      brown           19   fema… femin…
##  6 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…
##  7 Beru Wh…    165    75 brown      light      blue            47   fema… femin…
##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu…
##  9 Biggs D…    183    84 black      light      brown           24   male  mascu…
## 10 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>De la misma manera podemos <strong>reordenar las columnas</strong>, indicando el nombre de columnas que queremos mover, y con <code>.after</code> y/o <code>.before</code> para indicar antes o después de que columnas queremos moverlas.</p>
<div class="sourceCode" id="cb874"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># altura y masa detrás de color de piel</span>
  <span class="fu">relocate</span><span class="op">(</span><span class="va">height</span>, <span class="va">mass</span>, .after <span class="op">=</span> <span class="va">skin_color</span><span class="op">)</span> </code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    hair_color  skin_color height  mass eye_color birth_year sex   gender
##    &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S… blond       fair          172    77 blue            19   male  mascu…
##  2 C-3PO   &lt;NA&gt;        gold          167    75 yellow         112   none  mascu…
##  3 R2-D2   &lt;NA&gt;        white, bl…     96    32 red             33   none  mascu…
##  4 Darth … none        white         202   136 yellow          41.9 male  mascu…
##  5 Leia O… brown       light         150    49 brown           19   fema… femin…
##  6 Owen L… brown, grey light         178   120 blue            52   male  mascu…
##  7 Beru W… brown       light         165    75 blue            47   fema… femin…
##  8 R5-D4   &lt;NA&gt;        white, red     97    32 red             NA   none  mascu…
##  9 Biggs … black       light         183    84 brown           24   male  mascu…
## 10 Obi-Wa… auburn, wh… fair          182    77 blue-gray       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb876"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># color de piel, pelo y ojos antes de peso</span>
  <span class="fu">relocate</span><span class="op">(</span><span class="va">hair_color</span>, <span class="va">skin_color</span>, <span class="va">eye_color</span>,
           .before <span class="op">=</span> <span class="va">mass</span><span class="op">)</span> </code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    height hair_color  skin_color eye_color  mass birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172 blond       fair       blue         77       19   male  mascu…
##  2 C-3PO      167 &lt;NA&gt;        gold       yellow       75      112   none  mascu…
##  3 R2-D2       96 &lt;NA&gt;        white, bl… red          32       33   none  mascu…
##  4 Darth …    202 none        white      yellow      136       41.9 male  mascu…
##  5 Leia O…    150 brown       light      brown        49       19   fema… femin…
##  6 Owen L…    178 brown, grey light      blue        120       52   male  mascu…
##  7 Beru W…    165 brown       light      blue         75       47   fema… femin…
##  8 R5-D4       97 &lt;NA&gt;        white, red red          32       NA   none  mascu…
##  9 Biggs …    183 black       light      brown        84       24   male  mascu…
## 10 Obi-Wa…    182 auburn, wh… fair       blue-gray    77       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Otra opción es hacerlo con <code>select()</code>, indicándole el orden de las columnas manualmente, pudiendo hacer uso de <code><a href="https://rdrr.io/pkg/tidyselect/man/everything.html">everything()</a></code> para <strong>incluir el resto de columnas no mencionadas anteriormente</strong>.</p>
<div class="sourceCode" id="cb878"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">name</span>, <span class="va">homeworld</span>, <span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name  homeworld height  mass hair_color skin_color eye_color birth_year sex  
##    &lt;chr&gt; &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;
##  1 Luke… Tatooine     172    77 blond      fair       blue            19   male 
##  2 C-3PO Tatooine     167    75 &lt;NA&gt;       gold       yellow         112   none 
##  3 R2-D2 Naboo         96    32 &lt;NA&gt;       white, bl… red             33   none 
##  4 Dart… Tatooine     202   136 none       white      yellow          41.9 male 
##  5 Leia… Alderaan     150    49 brown      light      brown           19   fema…
##  6 Owen… Tatooine     178   120 brown, gr… light      blue            52   male 
##  7 Beru… Tatooine     165    75 brown      light      blue            47   fema…
##  8 R5-D4 Tatooine      97    32 &lt;NA&gt;       white, red red             NA   none 
##  9 Bigg… Tatooine     183    84 black      light      brown           24   male 
## 10 Obi-… Stewjon      182    77 auburn, w… fair       blue-gray       57   male 
## # … with 77 more rows, and 5 more variables: gender &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<div id="crear-nuevas-variables-mutate" class="section level2">
<h2>
<span class="header-section-number">13.3</span> Crear nuevas variables (mutate)<a class="anchor" aria-label="anchor" href="#crear-nuevas-variables-mutate"><i class="fas fa-link"></i></a>
</h2>
<p>A veces no queremos modificar variables ya existentes sino <strong>crear nuevas variables/columnas</strong> en base a variables ya existentes. Para ello tenemos la opción de <code>mutate()</code> que nos permite crear una nueva variable en función de las existentes.</p>
<div class="sourceCode" id="cb880"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mutate: nos añade nuevas columnas usando funciones</span>
<span class="co"># aplicadas a nuestras variables</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>height_m <span class="op">=</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span> <span class="co"># altura en metros</span></code></pre></div>
<pre><code>## # A tibble: 87 × 15
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, height_m &lt;dbl&gt;</code></pre>
<p>Recuerda que para <strong>ver todas las columnas</strong> debes indicarle que quieres imprimir todas.</p>
<div class="sourceCode" id="cb882"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>height_m <span class="op">=</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 15
##    name               height  mass hair_color    skin_color  eye_color
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker        172    77 blond         fair        blue     
##  2 C-3PO                 167    75 &lt;NA&gt;          gold        yellow   
##  3 R2-D2                  96    32 &lt;NA&gt;          white, blue red      
##  4 Darth Vader           202   136 none          white       yellow   
##  5 Leia Organa           150    49 brown         light       brown    
##  6 Owen Lars             178   120 brown, grey   light       blue     
##  7 Beru Whitesun lars    165    75 brown         light       blue     
##  8 R5-D4                  97    32 &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter     183    84 black         light       brown    
## 10 Obi-Wan Kenobi        182    77 auburn, white fair        blue-gray
##    birth_year sex    gender    homeworld species films     vehicles  starships
##         &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1       19   male   masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2      112   none   masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3       33   none   masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4       41.9 male   masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5       19   female feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6       52   male   masculine Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7       47   female feminine  Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8       NA   none   masculine Tatooine  Droid   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9       24   male   masculine Tatooine  Human   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10       57   male   masculine Stewjon   Human   &lt;chr [6]&gt; &lt;chr [1]&gt; &lt;chr [5]&gt;
##    height_m
##       &lt;dbl&gt;
##  1     1.72
##  2     1.67
##  3     0.96
##  4     2.02
##  5     1.5 
##  6     1.78
##  7     1.65
##  8     0.97
##  9     1.83
## 10     1.82
## # … with 77 more rows</code></pre>
<p>Otra opción es <strong>quedarnos solo con las columnas nuevas creadas</strong> con <code>transmute()</code></p>
<div class="sourceCode" id="cb884"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">transmute</span><span class="op">(</span>height_m <span class="op">=</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 1
##    height_m
##       &lt;dbl&gt;
##  1     1.72
##  2     1.67
##  3     0.96
##  4     2.02
##  5     1.5 
##  6     1.78
##  7     1.65
##  8     0.97
##  9     1.83
## 10     1.82
## # … with 77 more rows</code></pre>
<p>Si queremos añadir <strong>varias variables</strong> en función de las ya existentes podemos hacerlo ya que permite incorporar los datos de forma secuencial sin duplicar órdenes de <code>mutate()</code> para cada una.</p>
<div class="sourceCode" id="cb886"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="co"># Calculamos altura en metros y el IMC</span>
  <span class="fu">mutate</span><span class="op">(</span>height_m <span class="op">=</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">100</span>,
         BMI <span class="op">=</span> <span class="va">mass</span> <span class="op">/</span> <span class="op">(</span><span class="va">height_m</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 16
##    name               height  mass hair_color    skin_color  eye_color
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker        172    77 blond         fair        blue     
##  2 C-3PO                 167    75 &lt;NA&gt;          gold        yellow   
##  3 R2-D2                  96    32 &lt;NA&gt;          white, blue red      
##  4 Darth Vader           202   136 none          white       yellow   
##  5 Leia Organa           150    49 brown         light       brown    
##  6 Owen Lars             178   120 brown, grey   light       blue     
##  7 Beru Whitesun lars    165    75 brown         light       blue     
##  8 R5-D4                  97    32 &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter     183    84 black         light       brown    
## 10 Obi-Wan Kenobi        182    77 auburn, white fair        blue-gray
##    birth_year sex    gender    homeworld species films     vehicles  starships
##         &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1       19   male   masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2      112   none   masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3       33   none   masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4       41.9 male   masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5       19   female feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6       52   male   masculine Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7       47   female feminine  Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8       NA   none   masculine Tatooine  Droid   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9       24   male   masculine Tatooine  Human   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10       57   male   masculine Stewjon   Human   &lt;chr [6]&gt; &lt;chr [1]&gt; &lt;chr [5]&gt;
##    height_m   BMI
##       &lt;dbl&gt; &lt;dbl&gt;
##  1     1.72  26.0
##  2     1.67  26.9
##  3     0.96  34.7
##  4     2.02  33.3
##  5     1.5   21.8
##  6     1.78  37.9
##  7     1.65  27.5
##  8     0.97  34.0
##  9     1.83  25.1
## 10     1.82  23.2
## # … with 77 more rows</code></pre>
<p>Como ves <strong>por defecto añade las columnas al final</strong> pero podemos <strong>reordenar las columnas</strong> como ya hemos visto</p>
<div class="sourceCode" id="cb888"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>height_m <span class="op">=</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">100</span>,
         BMI <span class="op">=</span> <span class="va">mass</span> <span class="op">/</span> <span class="op">(</span><span class="va">height_m</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">relocate</span><span class="op">(</span><span class="va">height_m</span>, <span class="va">BMI</span>, .after <span class="op">=</span> <span class="va">name</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 16
##    name   height_m   BMI height  mass hair_color skin_color eye_color birth_year
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 Luke …     1.72  26.0    172    77 blond      fair       blue            19  
##  2 C-3PO      1.67  26.9    167    75 &lt;NA&gt;       gold       yellow         112  
##  3 R2-D2      0.96  34.7     96    32 &lt;NA&gt;       white, bl… red             33  
##  4 Darth…     2.02  33.3    202   136 none       white      yellow          41.9
##  5 Leia …     1.5   21.8    150    49 brown      light      brown           19  
##  6 Owen …     1.78  37.9    178   120 brown, gr… light      blue            52  
##  7 Beru …     1.65  27.5    165    75 brown      light      blue            47  
##  8 R5-D4      0.97  34.0     97    32 &lt;NA&gt;       white, red red             NA  
##  9 Biggs…     1.83  25.1    183    84 black      light      brown           24  
## 10 Obi-W…     1.82  23.2    182    77 auburn, w… fair       blue-gray       57  
## # … with 77 more rows, and 7 more variables: sex &lt;chr&gt;, gender &lt;chr&gt;,
## #   homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
## #   starships &lt;list&gt;</code></pre>
<p>También podemos pasarle una <strong>función propia que queramos definir</strong>, no solo funciones de <code>R</code>. Vamos a definir la función que nos calcula el IMC, a la que llamaremos <code>BMI_fun</code>, que necesita solo de dos argumentos: la altura en metros y el peso.</p>
<div class="sourceCode" id="cb890"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">BMI_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span>, <span class="va">h</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">m</span> <span class="op">/</span> <span class="va">h</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">BMI_fun</span><span class="op">(</span><span class="fl">90</span>, <span class="fl">1.6</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 35.15625</code></pre>
<p>La función definida como <code>BMI_fun()</code> podemos ahora aplicarla dentro de <code>mutate()</code>.</p>
<div class="sourceCode" id="cb892"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>height_m <span class="op">=</span> <span class="va">height</span> <span class="op">/</span> <span class="fl">100</span>,
         BMI <span class="op">=</span> <span class="fu">BMI_fun</span><span class="op">(</span><span class="va">mass</span>, <span class="va">height_m</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Las movemos al inicio (por defecto las mete al final)</span>
  <span class="fu">relocate</span><span class="op">(</span><span class="va">height_m</span>, <span class="va">BMI</span>, .after <span class="op">=</span> <span class="va">name</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 16
##    name   height_m   BMI height  mass hair_color skin_color eye_color birth_year
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 Luke …     1.72  26.0    172    77 blond      fair       blue            19  
##  2 C-3PO      1.67  26.9    167    75 &lt;NA&gt;       gold       yellow         112  
##  3 R2-D2      0.96  34.7     96    32 &lt;NA&gt;       white, bl… red             33  
##  4 Darth…     2.02  33.3    202   136 none       white      yellow          41.9
##  5 Leia …     1.5   21.8    150    49 brown      light      brown           19  
##  6 Owen …     1.78  37.9    178   120 brown, gr… light      blue            52  
##  7 Beru …     1.65  27.5    165    75 brown      light      blue            47  
##  8 R5-D4      0.97  34.0     97    32 &lt;NA&gt;       white, red red             NA  
##  9 Biggs…     1.83  25.1    183    84 black      light      brown           24  
## 10 Obi-W…     1.82  23.2    182    77 auburn, w… fair       blue-gray       57  
## # … with 77 more rows, and 7 more variables: sex &lt;chr&gt;, gender &lt;chr&gt;,
## #   homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
## #   starships &lt;list&gt;</code></pre>
<p>También se pueden aplicar funciones más complejas como la función <code><a href="https://rdrr.io/pkg/purrr/man/map.html">map()</a></code> del paquete <a href="http://purrr.tidyverse.org">purrr</a>: dado que las listas no se pueden vectorizar, esta función nos permite <strong>aplicar operaciones a listas, elemento a elemento de cada una de ellas</strong>. Veamos un ejemplo: imagina que queremos calcular el número de películas en las que sale cada personaje de la saga.</p>
<div class="sourceCode" id="cb894"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Películas de los 5 primeros personajes</span>
<span class="va">starwars</span><span class="op">$</span><span class="va">films</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></code></pre></div>
<pre><code>## [[1]]
## [1] "The Empire Strikes Back" "Revenge of the Sith"    
## [3] "Return of the Jedi"      "A New Hope"             
## [5] "The Force Awakens"      
## 
## [[2]]
## [1] "The Empire Strikes Back" "Attack of the Clones"   
## [3] "The Phantom Menace"      "Revenge of the Sith"    
## [5] "Return of the Jedi"      "A New Hope"             
## 
## [[3]]
## [1] "The Empire Strikes Back" "Attack of the Clones"   
## [3] "The Phantom Menace"      "Revenge of the Sith"    
## [5] "Return of the Jedi"      "A New Hope"             
## [7] "The Force Awakens"      
## 
## [[4]]
## [1] "The Empire Strikes Back" "Revenge of the Sith"    
## [3] "Return of the Jedi"      "A New Hope"             
## 
## [[5]]
## [1] "The Empire Strikes Back" "Revenge of the Sith"    
## [3] "Return of the Jedi"      "A New Hope"             
## [5] "The Force Awakens"</code></pre>
<p>Las películas de cada personaje están en <strong>modo lista</strong>: no podíamos guardarlo en un <code>data.frame</code> ya que cada personaje ha podido participar en un número distinto (en una tabla, todas las columnas tienen la misma longitud). Para saber la cantidad de películas en las que ha participado el primer personaje basta con usar el comando <code><a href="https://rdrr.io/r/base/length.html">length()</a></code> (nos dará el número de elementos de la lista).</p>
<div class="sourceCode" id="cb896"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">starwars</span><span class="op">$</span><span class="va">films</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p><strong>¿Cómo aplicar dicha a función a cada personaje?</strong> Con <code><a href="https://rdrr.io/pkg/purrr/man/map.html">map()</a></code> y la función a aplicar en cada elemento de la lista.</p>
<div class="sourceCode" id="cb898"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mapeamos la lista con length</span>
<span class="op">(</span><span class="va">starwars</span><span class="op">$</span><span class="va">films</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></code></pre></div>
<pre><code>## [[1]]
## [1] 5
## 
## [[2]]
## [1] 6
## 
## [[3]]
## [1] 7
## 
## [[4]]
## [1] 4
## 
## [[5]]
## [1] 5
## 
## [[6]]
## [1] 3
## 
## [[7]]
## [1] 3
## 
## [[8]]
## [1] 1
## 
## [[9]]
## [1] 1
## 
## [[10]]
## [1] 6</code></pre>
<p>Si te fijas con los 10 primeros, lo que nos devuelve por defecto a su vez una lista, cuando a nosotros <strong>nos gustaría que nos devolviera un vector que poder incluir como columna</strong>. Para ello existen diversas funciones como <code><a href="https://rdrr.io/pkg/purrr/man/map.html">map_chr()</a></code>, <code><a href="https://rdrr.io/pkg/purrr/man/map.html">map_dbl()</a></code> para devolverlo en un formato concreto</p>
<div class="sourceCode" id="cb900"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mapeamos la lista con length pero devolvemos un vector de números enteros</span>
<span class="va">starwars</span><span class="op">$</span><span class="va">films</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_int</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 5 6 7 4 5 3 3 1 1 6 3 2 5 4 1 3 3 1 5 5 3 1 1 2 1 2 1 1 1 1 1 3 1 2 1 1 1 2
## [39] 1 1 2 1 1 3 1 1 1 3 3 3 2 2 2 1 3 2 1 1 1 2 2 1 1 2 2 1 1 1 1 1 1 1 2 1 1 2
## [77] 1 1 2 2 1 1 1 1 1 1 3</code></pre>
<p>Ya solo nos falta incorporar dicha operación a una nueva columna con <code>mutate()</code></p>
<div class="sourceCode" id="cb902"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="st">"n_peliculas"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_int</a></span><span class="op">(</span><span class="va">films</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">homeworld</span>, <span class="va">n_peliculas</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    name               homeworld n_peliculas
##    &lt;chr&gt;              &lt;chr&gt;           &lt;int&gt;
##  1 Luke Skywalker     Tatooine            5
##  2 C-3PO              Tatooine            6
##  3 R2-D2              Naboo               7
##  4 Darth Vader        Tatooine            4
##  5 Leia Organa        Alderaan            5
##  6 Owen Lars          Tatooine            3
##  7 Beru Whitesun lars Tatooine            3
##  8 R5-D4              Tatooine            1
##  9 Biggs Darklighter  Tatooine            1
## 10 Obi-Wan Kenobi     Stewjon             6
## # … with 77 more rows</code></pre>
<div id="recategorizar-columnas" class="section level3">
<h3>
<span class="header-section-number">13.3.1</span> Recategorizar columnas<a class="anchor" aria-label="anchor" href="#recategorizar-columnas"><i class="fas fa-link"></i></a>
</h3>
<p>Una operación también muy habitual es querer <strong>recategorizar nuestras variables</strong>: tenemos categorías ya existentes o variables numéricas que queremos convertir a categoría (factores en <code>R</code>). Supongamos por ejemplo que queremos <strong>crear una categoría para cada registro</strong> en función de su altura: menos de 120, entre 120 y 180, y más de 180. Para ello podemos hacer uso de la función <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>, a la que en el argumento <code>breaks</code> le debemos indicar los <strong>«cortes» o saltos de la variable</strong>.</p>
<div class="sourceCode" id="cb904"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span><span class="st">"estat_categoria"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">height</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">120</span>, <span class="fl">180</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 15
##    name               height  mass hair_color    skin_color  eye_color
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker        172    77 blond         fair        blue     
##  2 C-3PO                 167    75 &lt;NA&gt;          gold        yellow   
##  3 R2-D2                  96    32 &lt;NA&gt;          white, blue red      
##  4 Darth Vader           202   136 none          white       yellow   
##  5 Leia Organa           150    49 brown         light       brown    
##  6 Owen Lars             178   120 brown, grey   light       blue     
##  7 Beru Whitesun lars    165    75 brown         light       blue     
##  8 R5-D4                  97    32 &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter     183    84 black         light       brown    
## 10 Obi-Wan Kenobi        182    77 auburn, white fair        blue-gray
##    birth_year sex    gender    homeworld species films     vehicles  starships
##         &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1       19   male   masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2      112   none   masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3       33   none   masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4       41.9 male   masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5       19   female feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6       52   male   masculine Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7       47   female feminine  Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8       NA   none   masculine Tatooine  Droid   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9       24   male   masculine Tatooine  Human   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10       57   male   masculine Stewjon   Human   &lt;chr [6]&gt; &lt;chr [1]&gt; &lt;chr [5]&gt;
##    estat_categoria
##    &lt;fct&gt;          
##  1 (120,180]      
##  2 (120,180]      
##  3 (-Inf,120]     
##  4 (180, Inf]     
##  5 (120,180]      
##  6 (120,180]      
##  7 (120,180]      
##  8 (-Inf,120]     
##  9 (180, Inf]     
## 10 (180, Inf]     
## # … with 77 more rows</code></pre>
<p>Recuerda que si quieres <strong>mostrar solo las nuevas columnas</strong> creadas puedes usar <code>transmute()</code></p>
<div class="sourceCode" id="cb906"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">transmute</span><span class="op">(</span><span class="st">"estat_categoria"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">height</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">120</span>, <span class="fl">180</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 1
##    estat_categoria
##    &lt;fct&gt;          
##  1 (120,180]      
##  2 (120,180]      
##  3 (-Inf,120]     
##  4 (180, Inf]     
##  5 (120,180]      
##  6 (120,180]      
##  7 (120,180]      
##  8 (-Inf,120]     
##  9 (180, Inf]     
## 10 (180, Inf]     
## # … with 77 more rows</code></pre>
<p>Si queremos que la categoría tenga un nombre explícito (y no el intervalo en sí), podemos indicárselo en <code>labels =</code> el vector de nombres de las categorías.</p>
<div class="sourceCode" id="cb908"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu">transmute</span><span class="op">(</span><span class="st">"estat_categoria"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">height</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">120</span>, <span class="fl">180</span>, <span class="cn">Inf</span><span class="op">)</span>,
                                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bajos"</span>, <span class="st">"medios"</span>, <span class="st">"altos"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 1
##    estat_categoria
##    &lt;fct&gt;          
##  1 medios         
##  2 medios         
##  3 bajos          
##  4 altos          
##  5 medios         
##  6 medios         
##  7 medios         
##  8 bajos          
##  9 altos          
## 10 altos          
## # … with 77 more rows</code></pre>
<p>Otra opción es hacerlo con la función <code>factor</code> que nos transforma una variable en categoría.</p>
<div class="sourceCode" id="cb910"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Vamos a categorizar en bajitos a los que miden menos de 180 cm</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>talla <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">height</span> <span class="op">&lt;</span> <span class="fl">180</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bajos"</span>, <span class="st">"altos"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 15
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, talla &lt;fct&gt;</code></pre>
</div>
</div>
<div id="datos-ausentes-y-outliers" class="section level2">
<h2>
<span class="header-section-number">13.4</span> Datos ausentes y outliers<a class="anchor" aria-label="anchor" href="#datos-ausentes-y-outliers"><i class="fas fa-link"></i></a>
</h2>
<p>Como ya vimos en <a href="vectores.html#vectores">Tipos de datos I: vectores</a>, los datos ausentes en <code>R</code> pueden venir representados por valores <code>NA</code> o por valores <code>NaN</code> (en realidad este no sería ausente siendo estrictos, es simplemente un resultado no numérico dentro de los reales). <strong>¿Qué hacer con dichos valores?</strong></p>
<p>Una primera opción puede ser <strong>eliminar los registros que contengan campos ausentes en alguna de sus variables</strong>, haciendo uso de la función <code>drop_na()</code>.</p>
<div class="sourceCode" id="cb912"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Luke Sk…    172    77 blond       fair       blue            19   male  mascu…
## 2 Obi-Wan…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## 3 Anakin …    188    84 blond       fair       blue            41.9 male  mascu…
## 4 Chewbac…    228   112 brown       unknown    blue           200   male  mascu…
## 5 Wedge A…    170    77 brown       fair       hazel           21   male  mascu…
## 6 Darth M…    175    80 none        red        yellow          54   male  mascu…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Como ves solo 6 de los 87 registros tienen todos los campos completos. Como quizás <strong>no todos los campos sean igual de importantes</strong> en nuestros, podemos indicarle que nos elimine aquellos registros que tengan datos ausentes <strong>algunos campos en concreto</strong> (o una coelcción de ellos)</p>
<div class="sourceCode" id="cb914"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">mass</span>, <span class="va">height</span>, <span class="va">sex</span>, <span class="va">gender</span>, <span class="va">birth_year</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 36 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 Biggs …    183    84 black       light      brown           24   male  mascu…
##  9 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## 10 Anakin…    188    84 blond       fair       blue            41.9 male  mascu…
## # … with 26 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Otra opción es <strong>imputar su valor</strong> en el caso de variables cuantitativas por, por ejemplo, la <strong>media de la variable sin datos ausentes</strong>, y <strong>recategorizar las cuantitaivas creando un categoría</strong> per se de ausentes.</p>
<div class="sourceCode" id="cb916"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="co"># Variables cuanti</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>,
                <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Variables cuali: pasamos NA y "none" a "unknown"</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>,
                <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">|</span> <span class="va">.x</span> <span class="op">==</span> <span class="st">"none"</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 unknown     gold       yellow         112   unkn… mascu…
##  3 R2-D2       96    32 unknown     white, bl… red             33   unkn… mascu…
##  4 Darth …    202   136 unknown     white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 unknown     white, red red             87.6 unkn… mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p> </p>
<p>Muchas veces tendremos variables con <strong>valores muy alejados de la centralidad</strong>, centralidad normalmente entendida como media o mediana, valores muy extremos (conocidos como <strong>valores atípicos o outliers</strong>).</p>
<ul>
<li><p><strong>Respecto a la mediana/percentiles (iqr)</strong>: una definición de outlier muy habitual es definirlo como un <strong>valor muy alejado del primer/tercer cuartil</strong>. La definición que se suele usar es que el dato sea interior/superior al primer/tercer cuartil una amplitud de X veces el <strong>rango intercuartílico</strong> (conocido como <strong>IQR, calculado como el tercer cuartil menos el primer cuartil</strong>) por debajo/encima.</p></li>
<li><p><strong>Respecto a la media (gesd)</strong>: el criterio utilizado suele ser el conocido como GESD (Generlized Extreme Studentized Deviate Test), un contraste de hipótesis cuya hipótesis nula es que no hay atípicos en los datos. Puedes ver la formulación matemática en <a href="https://www.itl.nist.gov/div898/handbook/eda/section3/eda35h3.htm" class="uri">https://www.itl.nist.gov/div898/handbook/eda/section3/eda35h3.htm</a></p></li>
</ul>
<p>Para su localización automática usaremos el paquete <a href="https://github.com/business-science/anomalize">anomalize</a>, y la función homónima de dicho paquete, indicándole la columna individual en la que queremos detectar outliers y el método a usar. Con el método <code>method = "gesd"</code> realizaremos el contraste dato a dato de forma secuencial (si hay outlier lo quita individualmente y vuelve a ejecutarlo). Con <code>method = "iqr"</code>, ese factor <code>X</code> que nos distanciamos del primer y tercer cuartil es calculado como <code>0.15/alpha</code>, de forma que con <code>alpha = 0.05</code> (por ejemplo), dicho factor sería <code>X = 3</code>. Es <strong>MUY IMPORTANTE</strong> quitar antes los valores ausentes (para que pueda ejecutarse correctamente).</p>
<div class="sourceCode" id="cb918"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/anomalize">anomalize</a></span><span class="op">)</span>
<span class="co"># Importante: quitar antes missings</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">mass</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/anomalize/man/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">mass</span>, method <span class="op">=</span> <span class="st">"gesd"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 59 × 17
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 49 more rows, and 8 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, mass_l1 &lt;dbl&gt;,
## #   mass_l2 &lt;dbl&gt;, anomaly &lt;chr&gt;</code></pre>
<p>En las columnas <code>mass_l1</code> y <code>mass_l2</code> se nos han guardado los límites para considerar o no outlier, y en <code>anomaly</code> tendremos si el valor es un outlier o no. Podemos renombrar dicha columna y recategorizarlo con <code>TRUE/FALSE</code></p>
<div class="sourceCode" id="cb920"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">starwars</span> <span class="op">%&gt;%</span>
        <span class="fu">drop_na</span><span class="op">(</span><span class="va">mass</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/pkg/anomalize/man/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">mass</span>, method <span class="op">=</span> <span class="st">"gesd"</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu">rename</span><span class="op">(</span>outlier <span class="op">=</span> <span class="va">anomaly</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="co"># Eliminamos la variables auxiliares creadas</span>
        <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mass_l1</span>, <span class="va">mass_l2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu">mutate</span><span class="op">(</span>outlier <span class="op">=</span> <span class="op">(</span><span class="va">outlier</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 59 × 15
##    name               height  mass hair_color    skin_color  eye_color
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker        172    77 blond         fair        blue     
##  2 C-3PO                 167    75 &lt;NA&gt;          gold        yellow   
##  3 R2-D2                  96    32 &lt;NA&gt;          white, blue red      
##  4 Darth Vader           202   136 none          white       yellow   
##  5 Leia Organa           150    49 brown         light       brown    
##  6 Owen Lars             178   120 brown, grey   light       blue     
##  7 Beru Whitesun lars    165    75 brown         light       blue     
##  8 R5-D4                  97    32 &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter     183    84 black         light       brown    
## 10 Obi-Wan Kenobi        182    77 auburn, white fair        blue-gray
##    birth_year sex    gender    homeworld species films     vehicles  starships
##         &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1       19   male   masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2      112   none   masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3       33   none   masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4       41.9 male   masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5       19   female feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6       52   male   masculine Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7       47   female feminine  Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8       NA   none   masculine Tatooine  Droid   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9       24   male   masculine Tatooine  Human   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10       57   male   masculine Stewjon   Human   &lt;chr [6]&gt; &lt;chr [1]&gt; &lt;chr [5]&gt;
##    outlier
##    &lt;lgl&gt;  
##  1 FALSE  
##  2 FALSE  
##  3 TRUE   
##  4 TRUE   
##  5 FALSE  
##  6 TRUE   
##  7 FALSE  
##  8 FALSE  
##  9 FALSE  
## 10 FALSE  
## # … with 49 more rows</code></pre>
<p>Dicha variable auxiliar la podremos usar para <strong>decidir si incluir o no el registro</strong> en futuros pasos, pero también <strong>podemos usarla para imputarle un valor</strong> (por ejemplo, la media).</p>
<div class="sourceCode" id="cb922"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">starwars</span> <span class="op">%&gt;%</span>
        <span class="fu">drop_na</span><span class="op">(</span><span class="va">mass</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/pkg/anomalize/man/anomalize.html">anomalize</a></span><span class="op">(</span><span class="va">mass</span>, method <span class="op">=</span> <span class="st">"gesd"</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu">rename</span><span class="op">(</span>outlier <span class="op">=</span> <span class="va">anomaly</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="co"># Eliminamos la variables auxiliares creadas</span>
        <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mass_l1</span>, <span class="va">mass_l2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu">mutate</span><span class="op">(</span>outlier <span class="op">=</span> <span class="op">(</span><span class="va">outlier</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,
               mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">outlier</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span>, <span class="va">mass</span><span class="op">)</span><span class="op">)</span>,
      width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 59 × 15
##    name               height  mass hair_color    skin_color  eye_color
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker        172  77   blond         fair        blue     
##  2 C-3PO                 167  75   &lt;NA&gt;          gold        yellow   
##  3 R2-D2                  96  97.3 &lt;NA&gt;          white, blue red      
##  4 Darth Vader           202  97.3 none          white       yellow   
##  5 Leia Organa           150  49   brown         light       brown    
##  6 Owen Lars             178  97.3 brown, grey   light       blue     
##  7 Beru Whitesun lars    165  75   brown         light       blue     
##  8 R5-D4                  97  32   &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter     183  84   black         light       brown    
## 10 Obi-Wan Kenobi        182  77   auburn, white fair        blue-gray
##    birth_year sex    gender    homeworld species films     vehicles  starships
##         &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1       19   male   masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2      112   none   masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3       33   none   masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4       41.9 male   masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5       19   female feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6       52   male   masculine Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7       47   female feminine  Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8       NA   none   masculine Tatooine  Droid   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9       24   male   masculine Tatooine  Human   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10       57   male   masculine Stewjon   Human   &lt;chr [6]&gt; &lt;chr [1]&gt; &lt;chr [5]&gt;
##    outlier
##    &lt;lgl&gt;  
##  1 FALSE  
##  2 FALSE  
##  3 TRUE   
##  4 TRUE   
##  5 FALSE  
##  6 TRUE   
##  7 FALSE  
##  8 FALSE  
##  9 FALSE  
## 10 FALSE  
## # … with 49 more rows</code></pre>
</div>
<div id="ejercicios-8" class="section level2">
<h2>
<span class="header-section-number">13.5</span> 📝 Ejercicios<a class="anchor" aria-label="anchor" href="#ejercicios-8"><i class="fas fa-link"></i></a>
</h2>
<p>(haz click en las flechas para ver soluciones)</p>
<details><p><summary>📝<strong>Ejercicio 1</strong>: del fichero <code>starwars</code> encuentra todos los personajes que el peso esté entre 60 y 90, de ojos que no sean azules, y que tengan menos de 100 años. Haz primero que se impriman todas las columnas. Muestra luego solo las columnas <code>name</code>, <code>mass</code>, <code>eye_color</code> y <code>birth_year</code>.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb924"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># todas columnas</span>
<span class="va">filtro</span> <span class="op">&lt;-</span>
  <span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">between</span><span class="op">(</span><span class="va">mass</span>, <span class="fl">60</span>, <span class="fl">90</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">eye_color</span> <span class="op">!=</span> <span class="st">"blue"</span> <span class="op">&amp;</span> <span class="va">birth_year</span> <span class="op">&lt;</span> <span class="fl">100</span><span class="op">)</span>
<span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">filtro</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 15 × 14
##    name              height  mass hair_color    skin_color   eye_color
##    &lt;chr&gt;              &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;        &lt;chr&gt;    
##  1 Biggs Darklighter    183  84   black         light        brown    
##  2 Obi-Wan Kenobi       182  77   auburn, white fair         blue-gray
##  3 Han Solo             180  80   brown         fair         brown    
##  4 Greedo               173  74   &lt;NA&gt;          green        black    
##  5 Wedge Antilles       170  77   brown         fair         hazel    
##  6 Palpatine            170  75   grey          pale         yellow   
##  7 Boba Fett            183  78.2 black         fair         brown    
##  8 Lando Calrissian     177  79   black         dark         brown    
##  9 Ackbar               180  83   none          brown mottle orange   
## 10 Jar Jar Binks        196  66   none          orange       orange   
## 11 Darth Maul           175  80   none          red          yellow   
## 12 Mace Windu           188  84   none          dark         brown    
## 13 Ki-Adi-Mundi         198  82   white         pale         yellow   
## 14 Plo Koon             188  80   none          orange       black    
## 15 Jango Fett           183  79   black         tan          brown    
##    birth_year sex   gender    homeworld    species      films     vehicles 
##         &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;        &lt;list&gt;    &lt;list&gt;   
##  1       24   male  masculine Tatooine     Human        &lt;chr [1]&gt; &lt;chr [0]&gt;
##  2       57   male  masculine Stewjon      Human        &lt;chr [6]&gt; &lt;chr [1]&gt;
##  3       29   male  masculine Corellia     Human        &lt;chr [4]&gt; &lt;chr [0]&gt;
##  4       44   male  masculine Rodia        Rodian       &lt;chr [1]&gt; &lt;chr [0]&gt;
##  5       21   male  masculine Corellia     Human        &lt;chr [3]&gt; &lt;chr [1]&gt;
##  6       82   male  masculine Naboo        Human        &lt;chr [5]&gt; &lt;chr [0]&gt;
##  7       31.5 male  masculine Kamino       Human        &lt;chr [3]&gt; &lt;chr [0]&gt;
##  8       31   male  masculine Socorro      Human        &lt;chr [2]&gt; &lt;chr [0]&gt;
##  9       41   male  masculine Mon Cala     Mon Calamari &lt;chr [2]&gt; &lt;chr [0]&gt;
## 10       52   male  masculine Naboo        Gungan       &lt;chr [2]&gt; &lt;chr [0]&gt;
## 11       54   male  masculine Dathomir     Zabrak       &lt;chr [1]&gt; &lt;chr [1]&gt;
## 12       72   male  masculine Haruun Kal   Human        &lt;chr [3]&gt; &lt;chr [0]&gt;
## 13       92   male  masculine Cerea        Cerean       &lt;chr [3]&gt; &lt;chr [0]&gt;
## 14       22   male  masculine Dorin        Kel Dor      &lt;chr [3]&gt; &lt;chr [0]&gt;
## 15       66   male  masculine Concord Dawn Human        &lt;chr [1]&gt; &lt;chr [0]&gt;
##    starships
##    &lt;list&gt;   
##  1 &lt;chr [1]&gt;
##  2 &lt;chr [5]&gt;
##  3 &lt;chr [2]&gt;
##  4 &lt;chr [0]&gt;
##  5 &lt;chr [1]&gt;
##  6 &lt;chr [0]&gt;
##  7 &lt;chr [1]&gt;
##  8 &lt;chr [1]&gt;
##  9 &lt;chr [0]&gt;
## 10 &lt;chr [0]&gt;
## 11 &lt;chr [1]&gt;
## 12 &lt;chr [0]&gt;
## 13 &lt;chr [0]&gt;
## 14 &lt;chr [1]&gt;
## 15 &lt;chr [0]&gt;</code></pre>
<div class="sourceCode" id="cb926"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Solo name, mass, eye_color, birth_year</span>
<span class="va">filtro</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">mass</span>, <span class="va">eye_color</span>, <span class="va">birth_year</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 15 × 4
##    name               mass eye_color birth_year
##    &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;
##  1 Biggs Darklighter  84   brown           24  
##  2 Obi-Wan Kenobi     77   blue-gray       57  
##  3 Han Solo           80   brown           29  
##  4 Greedo             74   black           44  
##  5 Wedge Antilles     77   hazel           21  
##  6 Palpatine          75   yellow          82  
##  7 Boba Fett          78.2 brown           31.5
##  8 Lando Calrissian   79   brown           31  
##  9 Ackbar             83   orange          41  
## 10 Jar Jar Binks      66   orange          52  
## 11 Darth Maul         80   yellow          54  
## 12 Mace Windu         84   brown           72  
## 13 Ki-Adi-Mundi       82   yellow          92  
## 14 Plo Koon           80   black           22  
## 15 Jango Fett         79   brown           66</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 2</strong>: selecciona solo las columnas que contengan variables numéricas, coloca los años de nacimiento como primera columna y cambia los nombres a castellano.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb928"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">relocate</span><span class="op">(</span><span class="va">height</span>, <span class="va">mass</span>, .after <span class="op">=</span> <span class="va">birth_year</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>edad <span class="op">=</span> <span class="va">birth_year</span>, altura <span class="op">=</span> <span class="va">height</span>, peso <span class="op">=</span> <span class="va">mass</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##     edad altura  peso
##    &lt;dbl&gt;  &lt;int&gt; &lt;dbl&gt;
##  1  19      172    77
##  2 112      167    75
##  3  33       96    32
##  4  41.9    202   136
##  5  19      150    49
##  6  52      178   120
##  7  47      165    75
##  8  NA       97    32
##  9  24      183    84
## 10  57      182    77
## # … with 77 more rows</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 3</strong>: calcula una nueva columna que indique el número de naves que ha pilotado cada persona (escribe <code>? starwars</code> en consola para ver documentación del fichero). Filtra después solo aquellos personajes que han conducido alguna nave, y crea una nueva variable <code>TRUE/FALSE</code> que nos diga si ha conducido o no alguna nave.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb930"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>n_naves <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_chr</a></span><span class="op">(</span><span class="va">starships</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 15
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  4 Darth …    202   136 none        white      yellow          41.9 male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Owen L…    178   120 brown, grey light      blue            52   male  mascu…
##  7 Beru W…    165    75 brown       light      blue            47   fema… femin…
##  8 R5-D4       97    32 &lt;NA&gt;        white, red red             NA   none  mascu…
##  9 Biggs …    183    84 black       light      brown           24   male  mascu…
## 10 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
## # … with 77 more rows, and 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, n_naves &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb932"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Imprimimos todas las columnas</span>
<span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">starwars</span> <span class="op">%&gt;%</span>
        <span class="fu">mutate</span><span class="op">(</span>n_naves <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_chr</a></span><span class="op">(</span><span class="va">starships</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 15
##    name               height  mass hair_color    skin_color  eye_color
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 Luke Skywalker        172    77 blond         fair        blue     
##  2 C-3PO                 167    75 &lt;NA&gt;          gold        yellow   
##  3 R2-D2                  96    32 &lt;NA&gt;          white, blue red      
##  4 Darth Vader           202   136 none          white       yellow   
##  5 Leia Organa           150    49 brown         light       brown    
##  6 Owen Lars             178   120 brown, grey   light       blue     
##  7 Beru Whitesun lars    165    75 brown         light       blue     
##  8 R5-D4                  97    32 &lt;NA&gt;          white, red  red      
##  9 Biggs Darklighter     183    84 black         light       brown    
## 10 Obi-Wan Kenobi        182    77 auburn, white fair        blue-gray
##    birth_year sex    gender    homeworld species films     vehicles  starships
##         &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1       19   male   masculine Tatooine  Human   &lt;chr [5]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt;
##  2      112   none   masculine Tatooine  Droid   &lt;chr [6]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  3       33   none   masculine Naboo     Droid   &lt;chr [7]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  4       41.9 male   masculine Tatooine  Human   &lt;chr [4]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
##  5       19   female feminine  Alderaan  Human   &lt;chr [5]&gt; &lt;chr [1]&gt; &lt;chr [0]&gt;
##  6       52   male   masculine Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  7       47   female feminine  Tatooine  Human   &lt;chr [3]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  8       NA   none   masculine Tatooine  Droid   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [0]&gt;
##  9       24   male   masculine Tatooine  Human   &lt;chr [1]&gt; &lt;chr [0]&gt; &lt;chr [1]&gt;
## 10       57   male   masculine Stewjon   Human   &lt;chr [6]&gt; &lt;chr [1]&gt; &lt;chr [5]&gt;
##    n_naves
##    &lt;chr&gt;  
##  1 2      
##  2 0      
##  3 0      
##  4 1      
##  5 0      
##  6 0      
##  7 0      
##  8 0      
##  9 1      
## 10 5      
## # … with 77 more rows</code></pre>
<div class="sourceCode" id="cb934"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Solo la columna añadida</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu">transmute</span><span class="op">(</span>n_naves <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_chr</a></span><span class="op">(</span><span class="va">starships</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 1
##    n_naves
##    &lt;chr&gt;  
##  1 2      
##  2 0      
##  3 0      
##  4 1      
##  5 0      
##  6 0      
##  7 0      
##  8 0      
##  9 1      
## 10 5      
## # … with 77 more rows</code></pre>
<div class="sourceCode" id="cb936"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Filtro</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>n_naves <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_chr</a></span><span class="op">(</span><span class="va">starships</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">n_naves</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 20 × 15
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172  77   blond       fair       blue            19   male  mascu…
##  2 Darth …    202 136   none        white      yellow          41.9 male  mascu…
##  3 Biggs …    183  84   black       light      brown           24   male  mascu…
##  4 Obi-Wa…    182  77   auburn, wh… fair       blue-gray       57   male  mascu…
##  5 Anakin…    188  84   blond       fair       blue            41.9 male  mascu…
##  6 Chewba…    228 112   brown       unknown    blue           200   male  mascu…
##  7 Han So…    180  80   brown       fair       brown           29   male  mascu…
##  8 Wedge …    170  77   brown       fair       hazel           21   male  mascu…
##  9 Jek To…    180 110   brown       fair       blue            NA   male  mascu…
## 10 Boba F…    183  78.2 black       fair       brown           31.5 male  mascu…
## 11 Lando …    177  79   black       dark       brown           31   male  mascu…
## 12 Arvel …     NA  NA   brown       fair       brown           NA   male  mascu…
## 13 Nien N…    160  68   none        grey       black           NA   male  mascu…
## 14 Ric Ol…    183  NA   brown       fair       blue            NA   &lt;NA&gt;  &lt;NA&gt;  
## 15 Darth …    175  80   none        red        yellow          54   male  mascu…
## 16 Plo Ko…    188  80   none        orange     black           22   male  mascu…
## 17 Gregar…    185  85   black       dark       brown           NA   male  mascu…
## 18 Grievo…    216 159   none        brown, wh… green, y…       NA   male  mascu…
## 19 Poe Da…     NA  NA   brown       light      brown           NA   male  mascu…
## 20 Padmé …    165  45   brown       light      brown           46   fema… femin…
## # … with 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;, n_naves &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb938"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Nueva columna lógica</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>n_naves <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_chr</a></span><span class="op">(</span><span class="va">starships</span>, <span class="va">length</span><span class="op">)</span>,
         conducir_nave <span class="op">=</span> <span class="va">n_naves</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">conducir_nave</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 20 × 16
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke S…    172  77   blond       fair       blue            19   male  mascu…
##  2 Darth …    202 136   none        white      yellow          41.9 male  mascu…
##  3 Biggs …    183  84   black       light      brown           24   male  mascu…
##  4 Obi-Wa…    182  77   auburn, wh… fair       blue-gray       57   male  mascu…
##  5 Anakin…    188  84   blond       fair       blue            41.9 male  mascu…
##  6 Chewba…    228 112   brown       unknown    blue           200   male  mascu…
##  7 Han So…    180  80   brown       fair       brown           29   male  mascu…
##  8 Wedge …    170  77   brown       fair       hazel           21   male  mascu…
##  9 Jek To…    180 110   brown       fair       blue            NA   male  mascu…
## 10 Boba F…    183  78.2 black       fair       brown           31.5 male  mascu…
## 11 Lando …    177  79   black       dark       brown           31   male  mascu…
## 12 Arvel …     NA  NA   brown       fair       brown           NA   male  mascu…
## 13 Nien N…    160  68   none        grey       black           NA   male  mascu…
## 14 Ric Ol…    183  NA   brown       fair       blue            NA   &lt;NA&gt;  &lt;NA&gt;  
## 15 Darth …    175  80   none        red        yellow          54   male  mascu…
## 16 Plo Ko…    188  80   none        orange     black           22   male  mascu…
## 17 Gregar…    185  85   black       dark       brown           NA   male  mascu…
## 18 Grievo…    216 159   none        brown, wh… green, y…       NA   male  mascu…
## 19 Poe Da…     NA  NA   brown       light      brown           NA   male  mascu…
## 20 Padmé …    165  45   brown       light      brown           46   fema… femin…
## # … with 7 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;, n_naves &lt;chr&gt;, conducir_nave &lt;lgl&gt;</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 4</strong>: ordena a los personajes de mayor a menor número de películas en las que ha aparecido</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb940"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="co"># Calculamos el número de películas</span>
  <span class="fu">mutate</span><span class="op">(</span>n_films <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_int</a></span><span class="op">(</span><span class="va">films</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">n_films</span><span class="op">)</span><span class="op">)</span> <span class="co"># Ordenamos de mayor a menor</span></code></pre></div>
<pre><code>## # A tibble: 87 × 15
##    name    height  mass hair_color  skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 R2-D2       96    32 &lt;NA&gt;        white, bl… red             33   none  mascu…
##  2 C-3PO      167    75 &lt;NA&gt;        gold       yellow         112   none  mascu…
##  3 Obi-Wa…    182    77 auburn, wh… fair       blue-gray       57   male  mascu…
##  4 Luke S…    172    77 blond       fair       blue            19   male  mascu…
##  5 Leia O…    150    49 brown       light      brown           19   fema… femin…
##  6 Chewba…    228   112 brown       unknown    blue           200   male  mascu…
##  7 Yoda        66    17 white       green      brown          896   male  mascu…
##  8 Palpat…    170    75 grey        pale       yellow          82   male  mascu…
##  9 Darth …    202   136 none        white      yellow          41.9 male  mascu…
## 10 Han So…    180    80 brown       fair       brown           29   male  mascu…
## # … with 77 more rows, and 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, n_films &lt;int&gt;</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 5</strong>: selecciona 9 personajes al azar. Después selecciona los 5 personajes que en más películas han salido y los 5 que menos.</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb942"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Una extracción aleatoria</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 9 × 14
##   name     height  mass hair_color skin_color  eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Luke Sk…    172  77   blond      fair        blue            19   male  mascu…
## 2 Jocasta…    167  NA   white      fair        blue            NA   fema… femin…
## 3 Adi Gal…    184  50   none       dark        blue            NA   fema… femin…
## 4 Tarfful     234 136   brown      brown       blue            NA   male  mascu…
## 5 Jek Ton…    180 110   brown      fair        blue            NA   male  mascu…
## 6 Boba Fe…    183  78.2 black      fair        brown           31.5 male  mascu…
## 7 Bib For…    180  NA   none       pale        pink            NA   male  mascu…
## 8 Rey          NA  NA   brown      light       hazel           NA   fema… femin…
## 9 Shaak Ti    178  57   none       red, blue,… black           NA   fema… femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb944"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># otra (que sale distinta, claro)</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 9 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Lando Ca…    177    79 black      dark       brown             31 male  mascu…
## 2 Watto        137    NA black      blue, grey yellow            NA male  mascu…
## 3 Finis Va…    170    NA blond      fair       blue              91 male  mascu…
## 4 Ratts Ty…     79    15 none       grey, blue unknown           NA male  mascu…
## 5 Taun We      213    NA none       grey       black             NA fema… femin…
## 6 Wicket S…     88    20 brown      brown      brown              8 male  mascu…
## 7 Plo Koon     188    80 none       orange     black             22 male  mascu…
## 8 Bossk        190   113 none       green      red               53 male  mascu…
## 9 Dormé        165    NA brown      light      brown             NA fema… femin…
## # … with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode" id="cb946"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># personas que en más películas han salido (metiendo empates)</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>n_films <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_int</a></span><span class="op">(</span><span class="va">films</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">slice_max</span><span class="op">(</span><span class="va">n_films</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 8 × 15
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 R2-D2        96    32 &lt;NA&gt;        white, bl… red               33 none  mascu…
## 2 C-3PO       167    75 &lt;NA&gt;        gold       yellow           112 none  mascu…
## 3 Obi-Wan…    182    77 auburn, wh… fair       blue-gray         57 male  mascu…
## 4 Luke Sk…    172    77 blond       fair       blue              19 male  mascu…
## 5 Leia Or…    150    49 brown       light      brown             19 fema… femin…
## 6 Chewbac…    228   112 brown       unknown    blue             200 male  mascu…
## 7 Yoda         66    17 white       green      brown            896 male  mascu…
## 8 Palpati…    170    75 grey        pale       yellow            82 male  mascu…
## # … with 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;, n_films &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb948"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># personas que en más películas han salido (sin empates)</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>n_films <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_int</a></span><span class="op">(</span><span class="va">films</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">slice_max</span><span class="op">(</span><span class="va">n_films</span>, n <span class="op">=</span> <span class="fl">5</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 15
##   name     height  mass hair_color  skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 R2-D2        96    32 &lt;NA&gt;        white, bl… red               33 none  mascu…
## 2 C-3PO       167    75 &lt;NA&gt;        gold       yellow           112 none  mascu…
## 3 Obi-Wan…    182    77 auburn, wh… fair       blue-gray         57 male  mascu…
## 4 Luke Sk…    172    77 blond       fair       blue              19 male  mascu…
## 5 Leia Or…    150    49 brown       light      brown             19 fema… femin…
## # … with 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;, n_films &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb950"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># personas que en menos películas han salido (metiendo empates)</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>n_films <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_int</a></span><span class="op">(</span><span class="va">films</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">slice_min</span><span class="op">(</span><span class="va">n_films</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 46 × 15
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 R5-D4        97    32 &lt;NA&gt;       white, red red               NA none  mascu…
##  2 Biggs D…    183    84 black      light      brown             24 male  mascu…
##  3 Greedo      173    74 &lt;NA&gt;       green      black             44 male  mascu…
##  4 Jek Ton…    180   110 brown      fair       blue              NA male  mascu…
##  5 IG-88       200   140 none       metal      red               15 none  mascu…
##  6 Bossk       190   113 none       green      red               53 male  mascu…
##  7 Lobot       175    79 none       light      blue              37 male  mascu…
##  8 Mon Mot…    150    NA auburn     fair       blue              48 fema… femin…
##  9 Arvel C…     NA    NA brown      fair       brown             NA male  mascu…
## 10 Wicket …     88    20 brown      brown      brown              8 male  mascu…
## # … with 36 more rows, and 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;, n_films &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb952"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># personas que en menos películas han salido (sin empates)</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>n_films <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/purrr/man/map.html">map_int</a></span><span class="op">(</span><span class="va">films</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">slice_min</span><span class="op">(</span><span class="va">n_films</span>, n <span class="op">=</span> <span class="fl">5</span>, with_ties <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 15
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 R5-D4         97    32 &lt;NA&gt;       white, red red               NA none  mascu…
## 2 Biggs Da…    183    84 black      light      brown             24 male  mascu…
## 3 Greedo       173    74 &lt;NA&gt;       green      black             44 male  mascu…
## 4 Jek Tono…    180   110 brown      fair       blue              NA male  mascu…
## 5 IG-88        200   140 none       metal      red               15 none  mascu…
## # … with 6 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;, n_films &lt;int&gt;</code></pre>
<!-- tocstop -->
</details><p> </p>
<details><p><summary>📝<strong>Ejercicio 6</strong>: selecciona las columnas que se refieren a variables de color (ojos, piel, pelo).</summary></p>
<!-- toc -->
<ul>
<li>Solución:</li>
</ul>
<div class="sourceCode" id="cb954"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Contiene "color" independientemente de que sea sufijo o prefijo</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"color"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    hair_color    skin_color  eye_color
##    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 blond         fair        blue     
##  2 &lt;NA&gt;          gold        yellow   
##  3 &lt;NA&gt;          white, blue red      
##  4 none          white       yellow   
##  5 brown         light       brown    
##  6 brown, grey   light       blue     
##  7 brown         light       blue     
##  8 &lt;NA&gt;          white, red  red      
##  9 black         light       brown    
## 10 auburn, white fair        blue-gray
## # … with 77 more rows</code></pre>
<div class="sourceCode" id="cb956"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Contiene "color" como sufijo</span>
<span class="va">starwars</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidyselect/man/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"color"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    hair_color    skin_color  eye_color
##    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 blond         fair        blue     
##  2 &lt;NA&gt;          gold        yellow   
##  3 &lt;NA&gt;          white, blue red      
##  4 none          white       yellow   
##  5 brown         light       brown    
##  6 brown, grey   light       blue     
##  7 brown         light       blue     
##  8 &lt;NA&gt;          white, red  red      
##  9 black         light       brown    
## 10 auburn, white fair        blue-gray
## # … with 77 more rows</code></pre>
<!-- tocstop -->
</details>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="tidydata.html"><span class="header-section-number">12</span> Tidy data: ordenando datos</a></div>
<div class="next"><a href="resumenes.html"><span class="header-section-number">14</span> Resumiendo y relacionado los datos</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidyverse"><span class="header-section-number">13</span> Explorando los datos: incursión a tidyverse</a></li>
<li>
<a class="nav-link" href="#operaciones-con-filas"><span class="header-section-number">13.1</span> Operaciones con filas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#seleccionar-filas-filter-slice"><span class="header-section-number">13.1.1</span> Seleccionar filas (filter, slice)</a></li>
<li><a class="nav-link" href="#reordenar-filas-arrange"><span class="header-section-number">13.1.2</span> Reordenar filas (arrange)</a></li>
<li><a class="nav-link" href="#eliminar-filas.-eliminar-duplicados"><span class="header-section-number">13.1.3</span> Eliminar filas. Eliminar duplicados</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#operaciones-con-columnas"><span class="header-section-number">13.2</span> Operaciones con columnas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#seleccionar-select-y-extraer-pull-columnas"><span class="header-section-number">13.2.1</span> Seleccionar (select) y extraer (pull) columnas</a></li>
<li><a class="nav-link" href="#renombrar-rename-y-reordenar-relocate-columnas"><span class="header-section-number">13.2.2</span> Renombrar (rename) y reordenar (relocate) columnas</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#crear-nuevas-variables-mutate"><span class="header-section-number">13.3</span> Crear nuevas variables (mutate)</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#recategorizar-columnas"><span class="header-section-number">13.3.1</span> Recategorizar columnas</a></li></ul>
</li>
<li><a class="nav-link" href="#datos-ausentes-y-outliers"><span class="header-section-number">13.4</span> Datos ausentes y outliers</a></li>
<li><a class="nav-link" href="#ejercicios-8"><span class="header-section-number">13.5</span> 📝 Ejercicios</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/dadosdelaplace/intro-R/blob/master/12-tidyverse.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/dadosdelaplace/intro-R/edit/master/12-tidyverse.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Aprendiendo R sin morir en el intento</strong>" was written by Javier Álvarez Liébana. It was last built on Última actualización: 21-12-2021.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
