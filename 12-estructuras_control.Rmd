```{r echo = FALSE}
library(knitr)

# Color text
colorize <- function(x, color) {
  
  if (knitr::is_latex_output()) {
    
    sprintf("\\textcolor{%s}{%s}", color, x)
    
  } else if (knitr::is_html_output()) {
    
    sprintf("<span style='color: %s;'>%s</span>", color, x)
    
  } else { x }
}
```

# (PART) Haciendo el trabajo m谩s f谩cil {-}


# Estructuras de control: if-else {#if-else}

:::: {.blackbox data-latex=""}

Scripts usados:

* [**script11.R**](https://github.com/dadosdelaplace/courses-intro-R/blob/main/scripts/script11.R). Ver en <https://github.com/dadosdelaplace/courses-intro-R/blob/main/scripts/script11.R>

::::

Hasta ahora hemos trasteado con datos: hemos empezado desde una celda, para luego construir columnas (vectores), y luego juntarlas en algo parecido a una base de datos (tablas o _data.frame_). Pero para poder manejarnos con soltura con dichos datos es importante que conozcamos c贸mo se usan las <mark>**expresiones de control m谩s t铆picas**</mark>. 

Una <mark>**expresi贸n de control**</mark> ser谩 un <mark>**conjunto de 贸rdenes**</mark> que nos permiten decidir por d贸nde queremos que avance nuestro programa: 驴qu茅 hacemos si sucede A? 驴Y si sucede B?

Si has programado en alg煤n otro lenguaje, estar谩s familiarizado/a con elementos como un `if (blabla) {...} else {...}` (que los usaremos a veces) o bucles `for` y `while` (que intentaremos no usarlos en `R`). Si es la primera que programas en alg煤n lenguaje, no te preocupes, las empezamos desde cero, empezando por las <mark>**estructuras condicionales**</mark>


## if {}

Una de las estructuras de control m谩s famosas de cualquier lenguaje de programaci贸n es la estructura `if`: <mark>**SI las condiciones impuestas se cumplen (`TRUE`)**</mark>, ejecuta las 贸rdenes que tengamos dentro.

 
* `if (x == 1) { c贸digo A }`: si `condici贸n` (por ejemplo, `x == 1`) es cierta, se ejecuta `c贸digo A`; en caso contrario, no hace nada.

Definamos por ejemplo una variable sencilla, las edades de 8 personas.

```{r}
edades <- c(14, 17, 24, 56, 31, 20, 87, 73)
```

Para comprobar cuales son menores de edades podemos aplicar lo aprendido en temas anteriores, realizando una **comparaci贸n l贸gica**: si es menor de edad, devuelve un `TRUE`; en caso contrario, devuelve un `FALSE`.

```{r}
edades < 18
```

Con las funciones `any()` y `all()` podemos saber si <mark>**todos o alguno de los elementos**</mark> de un vector <mark>**cumplen una condici贸n**</mark>.

```{r}
all(edades >= 18) # todos mayores de edad
any(edades < 18) # existe algun menor de edad
```

Con dichos elementos vamos a construir nuestra **primera estructura condicional**: queremos que, SI existe alg煤n menor de edad, nos imprima un mensaje.

```{r}
if (any(edades < 18)) { # TRUE si al menos una persona mayor de edad
  
  print("existe alguna persona mayor de edad")
  
}
```

En caso de que no se cumplan las condiciones dentro del `if()` (condiciones que devuelvan un `FALSE`), no suceder谩 nada. Podemos hacer lo mismo cambiando la condici贸n: SI todos son mayores de edad, imprime el mensaje.

```{r}
if (all(edades >= 18)) { # TRUE si TODOS son mayores de edad
  
  print("todas las personas son mayores de edad")
  
}
```

F铆jate que en este caso no hemos obtenido ning煤n mensaje porque la condici贸n `all(edades >= 18)` no es cierta (no son todos mayores de 18 a帽os), as铆 que no ha ejecutado el c贸digo interno.

## if - else {}

La estructura `if (condicion) { }` puede ser combinada con un `else { }`: cuando la condici贸n del `if` no se cumpla (como en el 煤ltimo ejemplo), se ejecutar谩 el c贸digo que haya dentro del `else { }`, permiti茅ndonos decidir que sucede cuando S se cumple y cuando NO se cumple.

* `if (x == 1) { c贸digo A } else { c贸digo B }`: si `condici贸n` (por ejemplo, `x == 1`) es cierta, se ejecuta `c贸digo A`; si es falsa, se ejecuta `c贸digo B`.

Siguiendo con el ejemplo de las edades, queremos nos imprima un mensaje SI todos son mayores de edad, y un mensaje diferente en caso de que dicha condici贸n no se cumpla.

```{r}
if (all(edades >= 18)) { # TRUE si TODOS son mayores de edad
  
  print("todas las personas son mayores de edad")
  
} else { # si hay alguno menor de edad 
  
  print("existe alguna persona menor de edad")
}
```

Podemos ya complicar un poco el c贸digo con lo que hemos aprendido de temas anteriores. Por ejemplo, en caso de que no se cumpla (es decir, que haya alguno menor de edad), queremos extraer la edad por pantalla de esos menores (con `edades[edades < 18]` extraeremos las edades que cumplen la condici贸n de ser menor de edad).

```{r}
if (all(edades >= 18)) { # TRUE si TODOS son mayores de edad
  
  print("todas las personas son mayores de edad")
  
} else { # si hay alguno menor de edad 
  
  print(glue("Existen menores de edad. Sus edades son: {paste(edades[edades < 18], collapse = '-')} a帽os"))
}
```

## if - else anidados

Dicha estructura `if - else` puede <mark>**anidarse**</mark>, de forma que vayamos <mark>**concatenando**</mark> dichas estructuras, como en el ejemplo que tenemos debajo. Imagina que queremos realizar una acci贸n si todos fuesen mayores de edad; en caso contrario, pero si todos los menores de edad tienen 16 a帽os o m谩s, realizar otra acci贸n; en caso contrario, otra acci贸n

```{r}
if (all(edades >= 18)) { # TRUE si TODOS son mayores de edad
  
  print("todas las personas son mayores de edad")
  
} else if (all(edades >= 16)) { # si todos los menores de edad tienen >=16
  
  print("Existe alguna persona menor de edad pero todos con 16 a帽os o m谩s")
  
} else {
  
  print("Existe alguna persona menor de 16 a帽os")

}
```

## ifelse () vectorizado

Esta <mark>**estructura condicional puede ser vectorizada**</mark>, de forma que podamos reunir en una **sola fila un n煤mero elevado de estructuras de comparaci贸n** la funci贸n `ifelse()`, cuyos argumentos de entrada ser谩n la condici贸n a evaluar, lo que sucede cuando se cumple y lo que no, que aplicar谩 a cada elemento del vector de entrada. Con el ejemplo de las edades, vamos a **dejar el dato ausente si son menores de edad**, y si son mayores de edad se queda como est谩 (recuerda: primero la condici贸n, despu茅s lo que devuelve cuando es `TRUE`, y por 煤ltimo lo que devuelve cuando es `FALSE`)

```{r}
# NA si no cumple la condici贸n, la edad si se cumple.
ifelse(edades >= 18, edades, NA)
```

Todas estas estructuras no solo sirven para datos num茅ricos. Vamos a definir un vector de nombres con algunos ausentes (`NA`), y vamos a sustituir los ausentes por el texto `"nombre_desconocido"` (los que no sean ausentes, es decir los que `is.na()` devuelva `FALSE`, se quedan como est谩n).


```{r}
nombres <- c("Juan", "Mar铆a", NA, NA, "Luc铆a", "Carmen", "Javier",
             NA, "Carlos", NA, "Gregorio", "Paloma")

# Si tiene ausente --> "nombre_desconocido"
# Si no tiene ausente --> nombres originales
nombres <- ifelse(is.na(nombres), "nombre_desconocido", nombres)
nombres
```

Esta funci贸n `ifelse()` es muy util para codificar variables o averiguar cuales cumplen una condici贸n.

## Consejos


**`r colorize("CONSEJOS", "#20935E")`**

&nbsp;

**`r colorize("Rainbow parentheses", "#20935E")`**

Uno de los **errores m谩s habituales**, y que seguir谩s cometiendo aunque lleves a帽os programando, es <mark>**no cerrar un par茅ntesis que has abierto**</mark>, por lo que el programa no sabe si has acabado de llamar a una orden o no. Para ello en las nuevas versiones de `RStudio`, en el men煤 `Tools < Global Options < Code < Display` podemos habilitar la opci贸n `Rainbow Parentheses` que nos escribe cada par de `()` de un color distinto

```{r echo = FALSE, out.width = "80%", fig.align = "center", fig.cap = "Activando Rainbow Parentheses."}
knitr::include_graphics("./img/rainbow-parentheses.jpg")

```

&nbsp;

**`r colorize("Minimiza estructuras de control en el c贸digo", "#20935E")`**

Puedes colapsar las estructuras de control pulsando en la flecha que aparece a la izquierda de ellas en tu script.

&nbsp;



##  Ejercicios

(haz click en las flechas para ver soluciones)

<details>
  <summary><strong>Ejercicio 1</strong>: modifica el c贸digo inferior para imprimir un mensaje por pantalla si todos los datos del conjunto `airquality` son de meses que no sean enero.
  
```{r eval = FALSE}
# install.packages("dataset") # solo la primera vez
library(datasets) # paquete con los datos
mes <- airquality$Month

if (mes == 2) {
  
  print("Ning煤n dato es del mes de enero")
  
}
  
```
</summary>
  
<!-- toc -->
- Soluci贸n:

```{r}
# install.packages("dataset") # solo la primera vez
library(datasets) # paquete con los datos
mes <- airquality$Month

if (all(mes != 1)) { # todos con mes distinto de 1
  
  print("Ning煤n dato es del mes de enero")
  
}

```

<!-- tocstop -->
</details>

&nbsp;

<details>
  <summary><strong>Ejercicio 2</strong>: modifica el c贸digo inferior para guardar en una variable `temperatura_alta` un valor `TRUE`  si alguno de los registros tiene una temperatura mayor a 90 (est谩n en Farenheit) y un `FALSE` en caso contrario.
  
```{r eval = FALSE}
temperatura <- airquality$Temp

if (temperatura == 100) {
  
  print("Alguno de los registros tiene temperatura superior a 90 Farenheit")
  
}
  
```
</summary>
  
<!-- toc -->
- Soluci贸n:

```{r}
temperatura <- airquality$Temp
temperatura_alta <- FALSE # por defecto FALSE
if (any(temperatura > 90)) {
  
  temperatura_alta <- TRUE # si se cumple la condici贸n, a TRUE
  
}

```

<!-- tocstop -->
</details>

&nbsp;

<details>
  <summary><strong>Ejercicio 3</strong>: modifica el c贸digo inferior para imprimir un mensaje por pantalla si alguno de los d铆as supera la temperatura de 100.
  
```{r eval = FALSE}
temperatura <- airquality$Temp

if (all(temperatura < 50)) {
  
  print("Alguno de los registros tiene temperatura superior a 100 Farenheit")
  
}
  
```

</summary>
  
<!-- toc -->
- Soluci贸n:

```{r}
temperatura <- airquality$Temp

if (any(temperatura > 100)) { # nos basta con uno
  
  print("Alguno de los registros tiene temperatura superior a 100 Farenheit")
  
}

```

No deber铆a imprimar nada porque ninguno cumple la condici贸n.


<!-- tocstop -->
</details>

&nbsp;

<details>
  <summary><strong>Ejercicio 4</strong>: del paquete `{lubridate}`, la funci贸n `hour()` nos devuelve la hora de una fecha dada, y la funci贸n `now()` nos devuelve fecha y hora del momento actual. Con ambas funciones, y usando `if`, imprime por pantalla  `"buenas noches"` solo a partir de las 21 horas. </summary>
  
<!-- toc -->
- Soluci贸n:

```{r}
# Cargamos librer铆a
library(lubridate)

# Fecha-hora actual
fecha_actual <- now()

# Estructura if
if (hour(fecha_actual) > 21) {
  
  cat("Buenas noches") # print/cat dos formas de imprimir por pantalla
}
```

<!-- tocstop -->
</details>

&nbsp;


<details>
  <summary><strong>Ejercicio 5</strong>: con las funciones del ejercicio anterior, y usando una estructura `if-else`, imprime por pantalla (con `cat()` o `print()`) los mensajes `"buenos d铆as"` (de 6 a 14 horas), `"buenas tardes"` (de 14 a 21 horas) o `"buenas noches"` (de las 21 a las 6 horas). </summary>
  
<!-- toc -->
- Soluci贸n:

```{r}
# Fecha actual
fecha_actual <- now()

# Estructura if-else
if (hour(fecha_actual) > 6 & hour(fecha_actual) < 14) {
  
  cat("Buenos d铆as")
  
} else if (hour(fecha_actual) > 14 & hour(fecha_actual) < 21) {
  
  cat("Buenas tardes")
  
} else {
  
  cat("Buenas noches")
}
```

<!-- tocstop -->
</details>

&nbsp;


<details>
  <summary><strong>Ejercicio 6</strong>: realiza el ejercicio anterior pero sin estructura de llaves, de forma concisa con `ifelse()`. Mira la ayuda si la necesitases poniendo `? ifelse` en consola. </summary>
  
<!-- toc -->
- Soluci贸n:

```{r}
# Fecha actual
fecha_actual <- now()

# Estructura if-else
cat(ifelse(hour(fecha_actual) > 6 & hour(fecha_actual) < 14,
           "Buenos d铆as",
           ifelse(hour(fecha_actual) > 14 &
                    hour(fecha_actual) < 21,
                  "Buenas tardes", "Buenas noches")))
  
```

<!-- tocstop -->
</details>

&nbsp;


